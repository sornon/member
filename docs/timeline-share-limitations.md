# 朋友圈分享「单页模式」问题说明

## 现象
- 活动页面分享到朋友圈后，接收方看到的是微信的「单页模式」落地页，需要点击底部「前往小程序」才会跳转。
- 在落地页点击前往小程序后，活动详情页会提示“查看活动详情点击右下角，前往小程序”（单页模式下的兜底文案）。

## 原因分析
1. **微信平台限制**：当分享载体是 H5/网页链接时，朋友圈默认使用「单页模式」打开，出于防刷与合规原因不会直接跳转到小程序，必须由用户手动点击「前往小程序」。该行为由微信客户端强制，无法在业务侧关闭。
2. **云函数依赖环境**：活动详情页的数据请求依赖 `wx.cloud.callFunction` 调用云函数。单页模式下页面以 WebView 打开，云开发能力不可用，导致接口调用失败并回退到“活动暂不可用”的兜底提示。【F:miniprogram/services/api.js†L162-L183】【F:miniprogram/pages/activities/detail/index.js†L191-L196】
3. **分享参数丢失风险**：单页模式无法保证 `onShareTimeline` 传递的查询参数被完整带入，可能出现活动 ID 丢失，进一步触发空数据或错误提示。【F:miniprogram/pages/activities/detail/index.js†L220-L258】
4. **正式版限制**：朋友圈卡片总是拉起线上正式版。若从开发版/体验版分享，接收方进入的仍是正式版；若正式版未包含最新页面或仍停留在 H5 落地页，将继续出现「单页模式」。

## 可行方案
- **引导从小程序内分享至朋友圈**：确保使用 `wx.shareTimeline` 能力生成小程序卡片，被点击时可直接在小程序环境打开，避免单页模式。【F:miniprogram/pages/activities/detail/index.js†L220-L258】
- **避免通过纯 H5 链接拉起**：如需朋友圈传播，优先使用小程序分享卡片或官方「公众号+小程序」跳转方案，避免把 H5 页面作为朋友圈入口。
- **提供 H5 降级页**：若业务必须使用 H5 入口，落地页需增加“活动不可用/请前往小程序”的提示和主动跳转引导，而不要依赖云函数能力，以免再次触发错误提示。
- **发布正式版后再测**：体验版/开发版分享只会打开线上正式版。需要先发布包含最新朋友圈分享改动的正式版，再用正式版验证是否还会进入单页模式。

## 结论
微信的客户端限制决定了朋友圈分享的落地页无法强制直接打开小程序。现有的“查看活动详情点击右下角，前往小程序”提示源于单页模式下云函数不可用导致的数据拉取失败。建议调整传播方式为小程序卡片分享，并为 H5 入口补充友好的降级提示。
