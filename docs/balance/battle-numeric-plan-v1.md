# 战斗数值策划案（V1）

## 1. 设计目标与约束
- 设计前提：
  - 服务端战斗由 `combat-system` 与 `skill-engine` 共同完成命中、暴击、伤害、资源结算，并在 PVE/PVP 入口中以 20/15 回合为上限输出结构化时间线。【F:docs/balance/battle-model-audit.md†L4-L47】
  - 核心公式存在固定常量（命中基准 0.85、0.9~1.1 浮动、暴击下限 1.2 等），且资源上限 100、初始 0、回合回复 20，首回合普攻占比高。【F:docs/balance/battle-model-audit.md†L18-L24】【F:docs/balance/battle-model-audit.md†L52-L59】
  - 当前新手阶段 PVE 易超时失败，PVP 则因缺少斩杀/衰减而易平局，需要通过成长曲线与模式系数改善体验。【F:docs/balance/battle-model-audit.md†L40-L50】
- 体验目标（可作为后续数值验收基准）：
  - 新手秘境前 3 章：有基础装备与正常操作时胜率 70%~85%，平均 5~8 回合结束。
  - 同等级新手 PVP：战力接近时平局概率 <10%，8~12 回合内决胜。
  - 中后期：每 10 级形成小台阶、每 30 级形成大台阶，保持 2 年以上的数值扩展空间（可追加境界/觉醒段）。
  - 爽感约束：确保首回合有 1~2 个技能可放（需结合真气设定），中后期在高爆发技能与恢复技能间保持攻防博弈。

## 2. 角色等级成长曲线
- 战斗相关基础属性列表（覆盖现行系统字段）：生命 `maxHp`、物攻 `physicalAttack`、法攻 `magicAttack`、物防 `physicalDefense`、法防 `magicDefense`、速度 `speed`、命中 `accuracy`、闪避 `dodge`、暴击率 `critRate`、暴击伤害 `critDamage`、终伤加成/减免 `finalDamageBonus`/`finalDamageReduction`、吸血、治疗增减与控制/穿透类扩展。【F:docs/balance/battle-model-audit.md†L15-L27】
- 曲线设计原则：
  - 1~10 级：略超线性（指数系数 1.05~1.1），每级能体感提升。
  - 11~40 级：趋于平滑（指数系数 1.0~1.05），避免爆炸。
  - 41~90 级：预留指数/分段跃迁（境界突破附加 8%~12% 斜率提升）。
- 推荐通用公式（`level` ≥1）：
  - 生命：`HP(level) = HP_base × (1 + 0.22 × level^1.08)`
  - 攻击（双攻同式，系数按职业偏移 ±5%）：`ATK(level) = ATK_base × (1 + 0.18 × level^1.06)`
  - 防御（双防同式）：`DEF(level) = DEF_base × (1 + 0.16 × level^1.05)`
  - 速度：`SPD(level) = SPD_base × (1 + 0.08 × level^0.95)`（确保速度天花板可控，避免多动过快）
  - 命中/闪避：`ACC/DOD(level) = STAT_base × (1 + 0.12 × level^1.0)`（维持对抗张力）
  - 暴击率：起始 5%，`CR(level) = min(0.05 + 0.003 × level, 0.35)`；暴伤：`CD(level) = 1.4 + 0.01 × level^0.9`（上限 2.4）。
- 示例（假设基础 1 级：HP=800，ATK=80，DEF=40，SPD=100，ACC=50）：
  - 1 级：HP≈976，ATK≈97，DEF≈52，SPD≈108，命中≈56，暴击≈8.0%
  - 10 级：HP≈3,600，ATK≈320，DEF≈170，SPD≈160，命中≈95，暴击≈35%
  - 20 级：HP≈7,500，ATK≈680，DEF≈350，SPD≈215，命中≈155，暴击≈35%（封顶）
  - 30 级：HP≈12,600，ATK≈1,140，DEF≈580，SPD≈260，命中≈215
  - 50 级：HP≈26,500，ATK≈2,250，DEF≈1,120，SPD≈340，命中≈335
- 设计理由：
  - HP 与防御略高于攻击的斜率，配合现有“伤害 = max(攻×25%, 攻-防)”与随机浮动，避免两回合秒杀。【F:docs/balance/battle-model-audit.md†L19-L22】
  - 暴击率硬上限 35% 与暴伤缓升，留出装备/技能与境界提升空间，同时避免早期暴击溢出。
  - 速度增长放缓，减少 PVP 中因速度过高导致连动/多动的极端情况。

## 3. 装备成长与数值结构
- 现状要点：装备加成在属性计算链中独立累加，支持基础值与百分比，并统计套装效果；缺少集中成长曲线定义。【F:docs/balance/battle-model-audit.md†L30-L38】
- 装备位与品质（建议沿用武器/头/衣/鞋/腰/护腕/项链/宝珠/信物等，品质白→绿→蓝→紫→橙→红）：
  - 同等级品质系数：白 1.0、绿 1.1、蓝 1.25、紫 1.45、橙 1.7、红 2.0。
  - 槽位系数示例：武器 1.2（主攻），衣服 1.3（主防/HP），鞋 1.0（速度/命中/闪避），饰品 0.9（暴击/控制/能量）。
- 装备属性构成：
  - 主属性：按槽位选择 1~2 项（如武器 = 攻击% 或最终增伤；衣服 = 生命% 或减伤；鞋 = 速度或命中）。
  - 副属性：2~3 条随机，覆盖暴击率/伤害、穿透、受疗、怒气获取等；高品质增加条数与词条档位。
- 强化/升星曲线（独立于角色等级）：
  - 强化等级 `enh` 0~20：主属性乘 `(1 + 0.04 × enh + 0.002 × enh^2)`，保证前期线性、后期略指数。
  - 升星（每 5 级一次）：额外 ×(1 + 0.08 × star)，并解锁一条副属性或提升词条档位。
- 装备与等级关系：
  - 角色等级提供基础值，装备提供 60%~90% 的追加提升；即同等级裸装 vs 满配差距维持在 1.0~1.8 倍，避免装备单独决定胜负。
  - 通过品质×槽位×强化三元结构，让玩家在同一等级内仍有追求空间，且不同槽位的成长斜率互补（武器攻向、衣服坦向、饰品功能向）。

## 4. 技能成长与伤害模型
- 分类草案：
  - 输出类：单体爆发、群伤、多段连击、条件追加（燃烧/易伤）、跟进追击。
  - 控制类：眩晕/沉默/减速/驱散（PVP 权重更高）。
  - 辅助/治疗类：治疗、护盾、增益（终伤、暴击、速度）、资源回充。
  - 资源/节奏类：降冷却、返真气、怒气转化。
- 通用成长框架：
  - `SkillDamage = BaseCoeff(level) × AttackType × (1 + Bonus)`，其中 `BaseCoeff(level) = coeff_1 + grow × (level-1)`；控制/护盾/治疗同理换算。
  - 建议初始系数与成长区间：
    - 单体爆发：1.0~1.4 起，每级 +0.04~0.06，可继承暴击。高品质终极技上限 2.2。
    - 群体伤害：0.7~1.0 起，每级 +0.03~0.05，目标数 3~5；PVP 可附加衰减系数 0.8。
    - 连击/多段：单段 0.45~0.8，每段成长 +0.02~0.04，段数 2~4；暴击逐段判定，便于爆发控线。
    - 条件追加/跟进：触发段 0.2~0.6，每级 +0.02~0.03，绑定状态或暴击事件。
    - 控制：基础命中 50%~80%，每级 +2%~3%；持续 1~2 回合，PVP 可单独设衰减或抗性检查。
    - 治疗/护盾：基础 12%~18% maxHP，每级 +0.6%~1%；护盾可附反伤 10% 起每级 +1%。
    - 资源型：返真气 10~30 点，或回合回复 +5~10，可与伤害/控制叠加但需冷却 3~5 回合。
- 示例（虚拟技能）：
  - “破空斩”（单体爆发）：倍率 1.2 +0.05/级，10 级≈1.65，相当于 ~1.5 次普攻；20 级≈2.15，约 2.0~2.2 次普攻。
  - “裂地波”（群伤）：倍率 0.9 +0.035/级，命中 3 目标；10 级≈1.25，每目标约 1.0 次普攻；附带 0.2 条件裂伤。
  - “灵息护体”（护盾+治疗）：护盾 18%+0.8%/级，治疗 12%+0.6%/级，冷却 3 回合；PVP 模式护盾系数 ×0.85 防止拉长战斗。
- 设计意图：
  - 与现有伤害公式的 0.9~1.1 浮动与暴击下限协同，确保技能放大倍数主要来源于系数和暴击，而非随机波动。【F:docs/balance/battle-model-audit.md†L19-L23】
  - 通过 PVE/PVP 独立衰减开口，为后续模式平衡预留调整空间。

## 5. 秘境（PVE）难度曲线
- 分层规划：新手教学 → 第 1~3 章（含 Boss）→ 中期主线 → 高阶秘境 → 挑战/活动副本。
- 战斗力期望与属性比例（相对同阶段玩家推荐属性）：
  - 新手普通怪：HP 1.0~1.2×，攻击 0.9~1.0×，防御 1.0×，速度 0.9×；目标回合数 5~8，胜率 70%~85%。
  - 章末 Boss：HP 1.8~2.4×，攻击 1.1~1.3×，防御 1.2×，速度 1.0×；目标回合数 8~12，胜率 55%~70%。
  - 中期秘境：每章怪物战力提升 12%~15%，Boss 额外 +10%；引入元素/控制抗性但保持 10~12 回合可胜。
  - 高阶/挑战：允许 HP 3~4×、防御 1.5×、攻击 1.3×，但掉落匹配投入，回合上限可放宽或加入斩杀线。
- 机制建议：
  - 首回合真气补给：在新手秘境前 3 章提供 +30 真气开局，保证至少 1 个技能可放，缓解当前首回合普攻过多的问题。【F:docs/balance/battle-model-audit.md†L52-L59】
  - 回合/超时：保持 20 回合上限但为新手章节设置 18 回合保护（超过按剩余血量判胜负），避免因磨血失败直接判负。【F:docs/balance/battle-model-audit.md†L40-L47】
  - 怪物成长：采用“章节基准 × 指数 1.04~1.06 × 品质系数”，品质系数普通 1.0、精英 1.15、Boss 1.35，并为 Boss 预留机制（护盾/易伤/断怒）。
- 解决“新手打不过”方向：
  - 下调新手怪物攻击/防御 10%~15%，HP 20%~30%，并提供教学装备用基础蓝品质，满足推荐战力。
  - 提升新手技能系数或降低早期技能冷却/消耗，使平均输出提高 15% 左右。
  - 可选：新手章节附加 5 回合内的“护体”减伤 10%，随章节消失。

## 6. PVP 匹配与数值目标
- 体验目标：平局少、节奏 8~12 回合、先手有博弈但不过度滚雪球。
- 数值约束与调整口：
  - 回合上限维持 15，但 12 回合后启用“疲劳”——伤害 ×1.1/回合叠加、治疗/护盾 ×0.9/回合衰减，15 回合仍未分胜负则按剩余 HP 判定。【F:docs/balance/battle-model-audit.md†L40-L47】
  - PVP 专用系数：
    - 伤害全局 ×1.05~1.15，治疗/护盾 ×0.8~0.9，控制命中检查不变但持续时间上限 2 回合。
    - 资源流：暴击/被暴击怒气 +2，普攻 +12，回合回复 +22，确保 1~2 回合能放技能，减少纯普攻局。【F:docs/balance/battle-model-audit.md†L52-L59】
  - 斩杀/护盾限制：当任意一方 HP <30% 时，治疗与护盾效果再 ×0.8，防止无限拉扯。
- 匹配逻辑建议：
  - 战力匹配：基础范围 ±10%，随等待时间每 10 秒放宽 2%（上限 ±20%）。
  - Elo 融合：在战力筛选后应用 Elo ±150 初始区间，随等待时间放宽至 ±300，优先同段位。
  - 队列异常保护：若 60 秒仍未匹配，提供“同段位但战力放宽”快速配对，或推荐改打 PVE。

## 7. 数值配置落地与维护策略
- 配置化拆分建议：
  - `role_growth.json`: 角色基础属性、等级曲线、境界/觉醒系数、暴击/暴伤/速度上限。
  - `equipment_growth.json`: 槽位系数、品质系数、强化/升星曲线、词条池与权重。
  - `skill_growth.json`: 技能层级、基础倍率、每级成长、冷却/消耗、PVE/PVP 分离系数。
  - `pve_difficulty.json`: 章节基准属性、品质系数、回合/真气/护体开场配置、奖励与推荐战力。
  - `pvp_rules.json`: 资源参数、伤害/治疗衰减、疲劳与斩杀阈值、匹配区间与 Elo 参数。
- 维护流程：
  - 新增装备/技能需对齐表内系数区间，过界需策划签字；上线前通过模拟战斗回归 PVE 胜率/回合数与 PVP 平局率。
  - 定期（每赛季/版本）根据实战数据调整 PVP 衰减与匹配范围；PVE 按章节/活动独立调整。
- 后续任务占位：
  - Task 3（实现层面）：将上述配置表落地到 `calculateAttributes`、`createActorRuntime` 等入口，剥离硬编码常量；为 PVE/PVP 入口增加模式参数读取。【F:docs/balance/battle-model-audit.md†L61-L70】
  - Task 4（监控）：建立战斗日志分析与胜率/回合时长看板，驱动数值微调。

