# 修仙风格会员等级成长体系

## 主境界设定
下表概述 10 个主境界的定位与体验要点，每个境界内划分 10 个小等级：

- **炼气期（1~10 级）**：入门境界，围绕吸纳灵气、强化体魄的设定，解锁灵根检测、入门服饰与灵宠幼崽等基础奖励。
- **筑基期（11~20 级）**：夯实根基与真元，聚焦丹炉、飞剑等主题，强化昵称前缀、包房基础折扣与合成材料投放。
- **结丹期（21~30 级）**：真元凝聚成丹，奖励包含结丹铭牌、锦云法袍、本命法宝皮肤与祥云坐骑。
- **元婴期（31~40 级）**：元神凝聚，寿元倍增，提供元神光影、分身宠物与高阶灵石投放，奠定精英身份。
- **化神期（41~50 级）**：初窥法则，法力不绝，奖励聚焦法则光纹、神识气泡与金仙试炼场景。
- **炼虚期（51~60 级）**：元婴化虚，凝练分身，解锁虚空流光、雾隐斗篷及尊贵徽记「炼虚印记」。
- **合体期（61~70 级）**：元神分身合一，显化法相真身，获得鸿蒙战铠、合体光环与动态法相演绎。
- **大乘期（71~80 级）**：修为圆满，掌控高阶法则，奖励聚焦道韵光芒、鸿蒙界扇与天宫场景。
- **真仙期（81~90 级）**：仙骨初成，点亮仙辉，强调云霄特效、仙霄战袍与护体仙光。
- **金仙期（91~100 级）**：位列金仙，享受终极荣耀，解锁金仙羽衣、云辇座驾与终极虚拟套装。

### 外观背景解锁说明
“外观设置”弹窗新增「背景」页签，与头像、相框并列。初入系统即默认开放「炼气之地」，之后每当完成主境界突破（即进入下一大境界的一层），便会奖励对应境界的场景背景，统一命名为“XX之地”。背景在首页 → 头像 → 外观设置 → 背景中随时切换，当前使用的背景会在列表中醒目标记。

| 主境界 | 背景名称 | 解锁节点 |
| --- | --- | --- |
| 炼气期 | 炼气之地 | 创建档案后默认可用 |
| 筑基期 | 筑基之地 | 达成筑基一层（11 级） |
| 结丹期 | 结丹之地 | 达成结丹一层（21 级） |
| 元婴期 | 元婴之地 | 达成元婴一层（31 级） |
| 化神期 | 化神之地 | 达成化神一层（41 级） |
| 炼虚期 | 炼虚之地 | 达成炼虚一层（51 级） |
| 合体期 | 合体之地 | 达成合体一层（61 级） |
| 大乘期 | 大乘之地 | 达成大乘一层（71 级） |
| 真仙期 | 真仙之地 | 达成真仙一层（81 级） |
| 金仙期 | 金仙之地 | 达成金仙一层（91 级） |

## 充值成长曲线
为匹配全新首阶奖励策略，各大境界的一层修为阈值与礼包调整如下。系统仍遵循 `1 元 = 100 修为` 的换算规则，境界内部其它层级在 `cloudfunctions/bootstrap/index.js` 的 `thresholds` 配置中以线性小步进呈现，便于后续微调。

| 主境界 | 等级区间 | 一层修为阈值 | 累计充值 | 首阶专属奖励 |
| --- | --- | --- | --- | --- |
| 炼气期 | 1~10 | 0 修为 | ¥0 | 入门奖励维持原方案（任意 120 元内饮品券 + 入门装扮） |
| 筑基期 | 11~20 | 200,000 修为 | ¥2,000 | 筑基背景 + ¥200 内商品任选 1 件 |
| 结丹期 | 21~30 | 500,000 修为 | ¥5,000 | 结丹背景 + 包房使用次数 1 次 |
| 元婴期 | 31~40 | 1,000,000 修为 | ¥10,000 | 元婴背景 + 包房使用次数 1 次 |
| 化神期 | 41~50 | 2,000,000 修为 | ¥20,000 | 化神背景（权益待定，可随时调整） |
| 炼虚期 | 51~60 | 5,000,000 修为 | ¥50,000 | 炼虚背景（权益待定，可随时调整） |
| 合体期 | 61~70 | 10,000,000 修为 | ¥100,000 | 合体背景（权益待定，可随时调整） |
| 大乘期 | 71~80 | 20,000,000 修为 | ¥200,000 | 大乘背景（权益待定，可随时调整） |
| 真仙期 | 81~90 | 50,000,000 修为 | ¥500,000 | 真仙背景（权益待定，可随时调整） |
| 金仙期 | 91~100 | 100,000,000 修为 | ¥1,000,000 | 金仙背景（权益待定，可随时调整） |

> 说明：首阶阈值及奖励与产品侧需求保持一致，其余层级的阈值可通过 `thresholds` 数组灵活拉升或压缩，确保冲刺节奏与成本控制之间取得平衡。

### 修为与充值联动规则

- **修为计算基准**：仅当会员钱包发生充值（会员自助微信充值或管理员后台手动发放）时，按照 `1 元 = 100 修为` 的比例累积修为值。系统内部以“分”为单位记录流水，因此在云函数中会把充值金额换算为对应的修为增量。
- **消费场景**：菜单下单、扫码扣费、管理员代扣等均归类为消费，仅影响余额、灵石奖励及订单状态，不再增加任何修为。
- **充值场景**：充值成功后同时增加钱包余额与修为值，例如充值 ¥2,000（即 200,000 分）会获得 200,000 修为，并可用余额继续线下消费。
- **升级用途**：修为值是唯一的等级成长依据，会与 `membershipLevels.threshold` 字段比对；达到阈值后自动提升境界并发放对应奖励。
- **灵石奖励**：灵石作为独立的虚拟货币，仅在任务、等级奖励等玩法中发放，全部以整数记录，不支持与现金钱包互转。

## 奖励结构
### 小等级奖励（每级发放）
- **身份标识**：逐级升级称号、昵称前缀、聊天气泡等，让会员持续获得可展示的身份标签。
- **视觉装扮**：每级解锁头像框、服饰、法宝模型或动作，营造收集与炫耀乐趣。
- **成长资源**：灵石积分、商城折扣加成、虚拟灵宠进阶等，与经营目标挂钩。

#### 炼气期 1~10 级奖励明细

| 等级 | 奖励内容 |
| --- | --- |
| 炼气一层 | 称号「炼气新人」（通过纳戒道具领取并解锁外观） |
| 炼气二层 | 背景「灵根测试」（纳戒任务道具，使用后永久解锁） |
| 炼气三层 | 武器「青竹练气杖」 |
| 炼气四层 | 技能「烈炽火弹」 |
| 炼气五层 | 装备「初阳布袍」 |
| 炼气六层 | 装备「翎痕轻履」 |
| 炼气七层 | 装备「知风木环」 |
| 炼气八层 | 装备「回鸣臂缚」 |
| 炼气九层 | 装备「清魂定珠」 |
| 炼气十层 | 道具「技能 5 连抽」×1、背景「筑基背景」解锁道具 |
| 筑基一层 | 称号「筑基初成」（通过纳戒道具领取并解锁外观） |
| 结丹一层 | 称号「结丹初凝」（通过纳戒道具领取并解锁外观） |
| 元婴一层 | 称号「元婴初现」（通过纳戒道具领取并解锁外观） |
| 化神一层 | 称号「化神初悟」（通过纳戒道具领取并解锁外观） |
| 炼虚一层 | 称号「炼虚洞明」（通过纳戒道具领取并解锁外观） |
| 合体一层 | 称号「合体初合」（通过纳戒道具领取并解锁外观） |

> 提示：称号与背景奖励会以任务/道具形式存入纳戒，需在纳戒页签手动使用后才会加入对应的解锁列表，便于会员自行选择激活时机。

### 境界突破大奖（每 10 级一次）
结合虚拟与实体权益，打造里程碑体验：

| 主境界 | 境界突破奖励 | 实体/服务权益 |
| --- | --- | --- |
| 炼气圆满 | 背景「筑基背景」 | 任意 120 元内饮品一杯 |
| 筑基圆满 | 虚拟特效「筑基雷纹」 | 私人包房券（1 小时） |
| 结丹圆满 | 上品武器「灵光剑」 + 技能 5 连抽礼包 | 古巴邑 10 年兑换券 1 张（价值 ¥980，可在点餐时抵扣同款酒品） |
| 元婴圆满 | 元婴分身主题 | 精品雪茄「云雾上品」 |
| 化神圆满 | 法则光翼装饰 | 珍藏红酒「神霖年份」 |
| 炼虚圆满 | 虚空行走特效 | 尊贵标识礼包（实体徽章） |
| 合体圆满 | 钻石级虚拟形象套装 | 专属尊享服务礼遇 |
| 大乘圆满 | 大乘天宫场景永久解锁 | 贵宾宴请券 1 次 |
| 真仙圆满 | 仙辉动态场景 | 整店欢聚夜包场券 1 次 |
| 金仙圆满 | 终极金仙套装 | 至尊黑卡（终身尊享） |

> 新增规则：炼气十层达到修为上限后将停留在当前境界，需在会员页点击「突破境界」按钮方可晋升筑基，并在突破时领取「筑基背景」与「任意 120 元内饮品一杯」权益券。
> 达到圆满仅会解锁突破资格，不会提前派发饮品券等突破权益，务必通过「突破境界」流程领取。

- 等级列表仅展示可在常规领取流程中获取的虚拟奖励，实体或突破权益会在点击「突破境界」时统一发放，并在境界大奖提示中说明。

## 虚拟与实体奖励搭配
- **虚拟奖励为高频主轴**：称号、装扮、特效、动作等无边际成本权益，贯穿全部等级，确保每次升级都有新反馈。
- **实体与服务奖励点睛**：在境界突破时发放包房券、礼盒、宴请券等高感知奖励，并优先利用闲时资源或与供应商合作的礼品降低成本。
- **数据驱动个性化**：可按用户偏好切换虚拟或实体倾向，例如对活动型用户增加包房券，对社交展示型用户强化特效与排行榜曝光。

### 结丹圆满突破权益说明

- **虚拟礼包**：突破后立即发放上品武器「灵光剑」与一次「技能 5 连抽」道具，均通过纳戒仓库领取，武器品质标记为上品（#6A4DF5）。
- **实体兑换券**：新增权益 `right_realm_core_cubaney_voucher`，在会员小程序点餐「古巴邑 10 年」时可抵扣 ¥980，交互与「任意饮品券（120 元内）」一致，支持在结算页勾选。
- **视觉呈现**：兑换券图标统一使用云存储素材 `item4.png`，在权益卡片、点餐页优惠栏与后台订单列表保持一致展示，便于运营识别。

## 成本与运营建议
- 建议按等级段设定奖励成本上限（如炼气期≤充值额 5%），高等级可适度提高但仍保持盈利空间。
- 将奖励与回流消费绑定，例如包房券限定非高峰时段、礼盒到店领取，形成“以奖促销”的闭环。
- 建立预算与预警机制，当某一段用户激增导致成本偏高时，及时调整升级门槛或改为等值虚拟奖励。

## 系统实现要点
- `cloudfunctions/bootstrap/level-config.js` 中集中维护 `realmConfigs`、`membershipRights`、`EXPERIENCE_PER_YUAN` 等纯数据，`index.js` 通过 `buildMembershipLevels()` 自动生成等级并注入云端集合，运营人员调整配置后重新执行引导脚本即可生效。

### 等级配置更新与部署注意事项
0. **公共模块**：[等级相关的配置信息都维护在公共模块level-config](https://tcb.cloud.tencent.com/dev?envId=cloud1-8gyoxq651fcc92c2#/scf?tab=layer)，`bootstrap`、`admin`、`menuOrder`、`wallet`这4个云函数需要绑定该层，引用该公共模块的方法为：`require('level-config')`。
1. **修改配置文件**：仅在 `cloudfunctions/nodejs-layer/level-config.js` 中调整修为换算、境界阈值、权益等纯数据，避免在其他云函数中写死常量。
2. **重新部署相关云函数**：提交修改后需要同步上传 `bootstrap`、`admin`、`menuOrder`、`wallet` 等引用该配置的云函数，确保运行时代码读取到最新参数。
3. **重新执行初始化脚本**：在微信云托管后台或命令行工具中再次触发 `bootstrap` 云函数，脚本会以相同 `_id` 覆写 `membershipLevels`、`membershipRights` 等集合条目，从而下发新配置。
4. **与历史数据的兼容性**：
   - `membershipLevels` 集合仅作为静态配置，被覆写后用户历史升级记录仍可继续使用，不会造成重复主键冲突。
   - 若调整 `EXPERIENCE_PER_YUAN` 或大幅修改阈值，请提前评估是否需要对既有会员的修为值或权益发放策略做补偿；系统不会自动回溯或迁移历史流水。
   - 若上线前已发放实体权益，建议结合运营需求确认是否需要追加新权益或通知用户，以免造成预期差异。
- `cloudfunctions/member/index.js` 扩展等级接口，返回境界描述、常规奖励与里程碑奖励，便于前端呈现完整信息。
- `miniprogram/pages/membership` 页面新增“主境界进阶”与“等级列表”展示，结合 `formatDiscount`、`levelBadgeColor` 等工具函数，可视化成长进度与奖励结构。

该方案通过明确的阶段目标、高频反馈与阶段性大奖，营造沉浸式修仙旅程，既满足用户炫耀与收集需求，也为商户提供可控、可调整的运营模型。
