# 装备系统重构方案

## 设计目标
在既有的六维基础属性与战斗属性框架下，重建一套强调战斗差异化、可持续成长与流派塑造的装备系统。方案完全沿用《寻道大千》的十二件装备槽位理念，聚焦装备的结构、属性生成、词条池与套装机制，暂不讨论掉落爆率、锻造与重铸等进阶玩法。

## 一、装备基础架构

### 0. 角色属性体系回顾

《寻道大千》的六维基础属性——体质、力量、灵力、根骨、敏捷、悟性——是所有装备数值的承载底座。它们先经 `calculateBaseAttributesForLevel` 与境界成长表累积基础值，再由 `deriveBaseCombatStats` 映射到生命、双攻、防御、速度、命中、闪避、暴击等战斗面板，最后叠加装备、技能与境界倍率构成最终数值。【F:docs/pve.md†L9-L64】【F:docs/pve.md†L67-L105】装备系统需要围绕这些映射关系设计属性分配，以便玩家在加点与装备之间形成明确的耦合路径。

> **六维属性到战斗属性的关键映射**
>
> | 基础属性 | 战斗属性影响 | 说明 | 推荐装备方向 |
> | --- | --- | --- | --- |
> | 体质 | 生命、最终减伤 | 每点体质提供 100 点生命与减伤系数，是坦克与治疗的耐久核心。 | 衣服、腰带主属性倾向生命%、减伤；副属性追求受疗、护盾。 |
> | 力量 | 物攻、破甲 | 每点力量提供 2 点物理攻击与 0.2 点防御穿透，直接提升近战输出。 | 武器、护腕主属性偏基础攻击/最终增伤；副属性追求暴击、破甲。 |
> | 灵力 | 法攻、治疗强化、法穿 | 同步提升法术输出与治疗量，支撑术法、奶妈双系成长。 | 法器、宝珠主属性偏法术强度/治疗强化；副属性堆最终增伤、弱化治疗。 |
> | 根骨 | 双防、控制抗性 | 既提高防御又提供控制抗性，并与体质共同决定最终减伤。 | 头部、衣服、信物主属性偏防御%、抗控；副属性补充格挡、最终减伤。 |
> | 敏捷 | 速度、闪避 | 决定行动顺序与闪避值，是先手与游击流派的基础。 | 鞋履、护腕主属性偏速度/闪避；副属性叠控制命中或命中。 |
> | 悟性 | 命中、暴击、控制命中 | 每点悟性提供命中、暴击率与暴击伤害，并影响掉落收益。 | 秘宝、项圈主属性偏命中/暴击；副属性可选暴击伤害、控制命中。 |

透过该表，装备设计可以对齐角色养成节奏：例如力量与灵力分别服务于物理/法术输出流派，因此在武器、法器、宝珠等槽位预设不同的主属性权重；敏捷与悟性则驱动速度、命中、暴击需求，决定鞋履、秘宝的词条池。装备提供的属性应强化玩家已投资的六维方向，并补足六维难以直接提供的战斗属性（如最终增伤、减伤、连击等倍增项），避免出现“六维投入和装备追求相互冲突”的体验。

### 1. 槽位划分
| 槽位 | 功能侧重 | 与六维属性的主要联动 |
| --- | --- | --- |
| 武器 | 输出与特效触发核心 | 攻击、暴击、速度 |
| 头部 | 防护与抗性 | 防御、精神、抗控 |
| 衣服 | 主体防御与生命 | 防御、生命、减伤 |
| 鞋履 | 机动与位移 | 速度、闪避、命中 |
| 腰带 | 稳定性与耐力 | 生命、减伤、治疗加成 |
| 护腕 | 攻防兼顾 | 攻击、连击、格挡 |
| 宝珠 | 特殊能力放大 | 精神、法术强度、辅助增益 |
| 项圈 | 能量调节 | 法力、控制命中、治疗强化 |
| 信物 | 阵营与身份加持 | 全属性、团队光环 |
| 傀儡 | 被动支援 | 反击、护盾、召唤支援 |
| 法器 | 术法增幅 | 法术强度、最终增伤 |
| 秘宝 | 终极增益 | 特殊词条、唯一增益 |

每个槽位默认绑定一组主属性候选池与若干副属性标签，确保装备在掉落时即可明确定位其战略价值。

> **主属性候选示例**
>
> | 槽位 | 主属性候选 | 权重建议 | 设计说明 |
> | --- | --- | --- | --- |
> | 武器 | 基础攻击、最终增伤、连击率 | 50% / 35% / 15% | 保持输出向主属性为主，少量连击作为稀有结果，制造惊喜感。 |
> | 头部 | 防御%、抗控、暴击抗性 | 45% / 35% / 20% | 兼顾防护与控制对抗，突出头盔在 PVP 中的重要性。 |
> | 衣服 | 生命%、减伤、护盾强度 | 40% / 40% / 20% | 核心坦度槽位，确保每件衣服都能显著提高生存能力。 |
> | 鞋履 | 速度、闪避、命中 | 60% / 25% / 15% | 速度优先，闪避、命中为流派分岔点。 |
> | 腰带 | 生命%、受疗、治疗强化 | 40% / 30% / 30% | 兼容坦克与治疗职业，受疗与治疗强化互为选择。 |
> | 护腕 | 攻击%、格挡、反击率 | 50% / 30% / 20% | 兼具输出与反击玩法的关键槽位。 |
> | 宝珠 | 法术强度、控制命中、怒气获取 | 45% / 35% / 20% | 强调法系与控制向的塑造。 |
> | 项圈 | 法力上限、治疗强化、控制强度 | 40% / 35% / 25% | 进一步细分辅助定位。 |
> | 信物 | 全属性%、团队光环、特殊效果 | 50% / 30% / 20% | 信物提供团队向主属性，特殊效果多为流派启始点。 |
> | 傀儡 | 反击率、护盾强度、召唤物强度 | 35% / 35% / 30% | 突出被动支援特色，可与反击、召唤流派联动。 |
> | 法器 | 法术强度、最终增伤、元素易伤 | 45% / 35% / 20% | 让术法输出与易伤流派互相补强。 |
> | 秘宝 | 特殊唯一词条、最终增伤、减伤 | 40% / 35% / 25% | 顶级槽位，通过唯一词条或双向增减伤塑造终局差异。 |

权重用于指引随机主属性的出现概率，配合后续的掉落源权重，可控制某些主属性的稀有度。例如高速控制流所需的“鞋履速度”“宝珠控制命中”，在权重上保持高概率，使流派成型门槛合理；而“武器连击率”“秘宝唯一词条”则通过低权重与高品质绑定，塑造顶级追求感。

> **槽位与六维属性耦合建议**
>
> - **体质/根骨型槽位**（衣服、腰带、头部、信物）：主属性权重偏向生命%、减伤、防御%、抗控；副属性池额外开放护盾强度、受疗加成，承接体质与根骨的坦度成长。
> - **力量导向槽位**（武器、护腕、傀儡）：主属性聚焦基础攻击、最终增伤、反击率，并在副属性池中放宽暴击、连击、破甲、吸血的概率，支撑物理爆发与反击。
> - **灵力导向槽位**（法器、宝珠、项圈）：主属性围绕法术强度、控制命中、治疗强化；副属性补充元素易伤、怒气获取、弱化治疗，以适应术法与辅助双职需求。
> - **敏捷/悟性导向槽位**（鞋履、秘宝、项圈）：主属性优先速度、闪避、命中；副属性则在速度、命中、控制命中之间轮换，帮助玩家突破行动与命中阈值。

上述耦合关系将装备与加点策略紧密绑定：例如高速控制流需要在敏捷、悟性上投入大量属性点，同时追求鞋履速度主属性与宝珠控制命中副属性；暴击爆发流则偏好悟性加点配合武器、护腕上的暴击/连击词条。

### 2. 装备等级
装备随角色等级划分为 1~60 级阶段（可拓展）。等级决定主属性基值、可解锁的词条品质以及可穿戴门槛。装备的数值成长由“等级基值 × 品质系数 × 槽位系数”计算。

## 二、品质与成长
装备稀有度体现潜力与词条数量。建议采用如下层级：

| 品质 | 标记颜色 | 主属性系数 | 副属性条数 | 词条品质范围 |
| --- | --- | --- | --- | --- |
| 凡品 | 灰 | 0.8 | 0 | 无 |
| 下品 | 绿 | 1.0 | 0 | 无 |
| 中品 | 蓝 | 1.1 | 1 | 普通攻击向 |
| 上品 | 紫 | 1.25 | 1 | 普通/稀有攻击向 |
| 极品 | 橙 | 1.4 | 2 | 攻击+防御（普通/稀有） |
| 仙品 | 红 | 1.6 | 2 | 攻击+防御（含高级） |
| 完美 | 金 | 1.85 | 2 | 攻击+防御（高级） |
| 先天 | 彩 | 2.05 | 3 | 攻、防、特殊（高级） |
| 至宝 | 虹 | 2.3 | 3（含必定特殊） | 传奇专属 |

- **主属性系数**：与等级、槽位基础值相乘，决定主属性最终数值。
- **副属性条数**：控制随机词条数量，高品质装备增加词条深度。
- **词条品质范围**：限定可抽取的词条池，避免低品质装备出现过强词条。

## 三、主属性规则
1. **槽位限定**：每个槽位设定 2~3 个主属性候选。例如武器主属性在“基础攻击”“最终增伤”“连击率”之间随机，鞋履则在“速度”“闪避”“命中”之间选择。
2. **数值计算**：
   - 基础值：根据槽位与等级预设，如 40 级武器基础攻击 320。
   - 品质调整：乘以主属性系数（如仙品 ×1.6）。
   - 随机浮动：±5% 随机波动，强化装备差异化。
3. **成长机制**：主属性可通过强化（未来系统）提升至 120% 上限，此处先预留成长曲线，不展开强化细节。

## 四、副属性（词条）体系
### 1. 词条分类
- **攻击类**：暴击率、暴击伤害、连击率、破甲、攻速/速度、最终增伤、吸血、伤害溢出、护甲穿透。
- **防御类**：减伤、最终减伤、生命值%、防御%、格挡率、抗暴击、抗控、闪避、护盾强度。
- **辅助类**：治疗强化、受疗加成、弱化治疗、增益延长、增益效果强度、减益抗性、能量回复、怒气获取。
- **功能/特殊类**：反击、控制命中、控制强度、召唤物强度、道法伤害倍率、元素易伤、队伍光环。

#### 词条作用深描
- **暴击/连击系**：暴击率与暴击伤害构成爆发的双核心，连击率提供额外段数，三者叠加构成指数型输出。暴击伤害基值保持 200%，装备每 +1% 暴击率都能带来边际收益，连击判定在暴击前执行，若两者同时成功则触发“暴击连击”计算（基于暴击伤害 × 连击段数）。
- **速度系**：速度与攻速统一为行动条推进速度，提升幅度直接影响回合制行动顺序。高速角色在 120% 行动条阈值时可实现 1 回合 2 动，配合控制命中可构建“先手→控场→续航”的闭环。
- **破甲/护甲穿透**：以“忽略目标 X% 防御”与“降低目标防御 Y%（持续 N 秒）”双模型并行，前者适合 PVE 刷怪，后者适合 PVP 团队配合。两者叠加时按照“先穿透后减防”的顺序计算，避免出现负防御异常。
- **吸血**：伤害结算后再行触发，按实际造成伤害的百分比恢复生命，默认无上限但受“重伤/弱化治疗”影响。吸血支持暴击继承，即暴击伤害越高，吸血恢复越显著。
- **减伤/最终减伤**：减伤按来源叠加（技能、装备），最终减伤在所有减伤计算完毕后执行，作为生存的最后一道防线。两者设有软上限：减伤总量超过 65% 后递减，最终减伤超过 30% 后递减，避免无敌局面。
- **闪避与命中对抗**：每点闪避抵消同等数值的命中，超出部分按 1 点 = 0.5% 闪避率换算；若命中高于闪避，则剩余命中转换为控制命中修正。该机制确保闪避堆叠需投入更多资源才能超越常规命中水平。
- **治疗强化/弱化治疗**：治疗强化提升输出端治疗量，受疗加成提高被治疗端收益；弱化治疗、重伤等则降低敌方受疗。三者相互作用时遵循“治疗量 ×(1+治疗强化)×(1+目标受疗-目标减疗)”公式，保证策略博弈。
- **控制类**：控制命中决定控场命中的基础概率，控制强度影响持续时间或效果强度。装备可提供“控制命中 +X%”“控制强度 +Y%”，传奇词条则可附带“命中后延长 1 回合”等特效。
- **反击**：触发条件通常为“受到直接攻击时”，默认冷却 1 回合，装备词条可减少冷却或提升反击伤害。反击不受闪避影响，但可被格挡、减伤削弱。
- **召唤物/道法强化**：召唤物强度影响召唤单位生命、攻击、持续时间，道法伤害倍率与最终增伤叠乘，支撑元素或术法流派。

#### 与六维属性的协同阈值

- **生命与减伤轴**：基础生命由 `500 + 体质 × 100 + 根骨 × 20` 计算，突破加成再乘算生命倍率。【F:docs/pve.md†L73-L105】装备在衣服、腰带槽位提供生命%、减伤、护盾强度，可将体质、根骨加点的收益拉到关键阈值，例如炼气末期（体质≈120）基础生命约 14,900，通过衣服主属性生命%（+40%）与腰带受疗/减伤副属性，可稳定提升到 20,000+ 的耐久层级。
- **双攻与穿透轴**：物攻与法攻分别为 `50 + 力量 × 2`、`50 + 灵力 × 2`，悟性还提供基础暴击率与暴击伤害。【F:docs/pve.md†L73-L105】因此暴击爆发流在力量、悟性上投入属性点后，需搭配武器主属性基础攻击、最终增伤以及暴击、连击等副属性，以在 2000+ 基础攻击的基础上进一步放大爆发；法术流则通过法器主属性法术强度和宝珠、秘宝的元素易伤达成技能增幅。
- **速度与行动经济**：基础速度 = `80 + 敏捷`，在 120% 行动条阈值时可实现单回合双动。【F:docs/pve.md†L73-L105】高速控制流除敏捷加点外，需要鞋履速度主属性（+60% 权重）和副属性速度/控制命中堆叠，以在 PVP 环境（平均速度 160 左右）上抢占 20% 以上的速度差，从而保证控制链稳定。
- **命中 vs 闪避**：命中 = `100 + 悟性`，闪避值 = `80 + 敏捷 × 0.9 + 悟性 × 0.4`，战斗时再经过 `clamp(0.85 + (命中 − 闪避) × 0.005, 0.2, 0.99)` 的命中判定。【F:docs/pve.md†L73-L134】【F:docs/pve.md†L129-L188】装备提供的命中、闪避副属性可视作微调阈值的手段：闪避游击流需要在鞋履、护腕、秘宝上合计堆出 60 以上的闪避额外值，才能在常见 220 命中的环境下维持 30% 以上的闪避差；命中流则通过秘宝、项圈的命中/控制命中词条抵消对手闪避。
- **暴击与抗暴链**：悟性提供初始 5% 暴击率与额外暴击收益，而装备的暴击率、暴击伤害词条在 `clamp(暴击率 − 抗暴, 5%, 95%)` 公式后生效。【F:docs/pve.md†L73-L134】【F:docs/pve.md†L189-L239】暴击爆发流在悟性投入达 150 时基础暴击率 20%，需再借装备将暴击率推至 80% 阈值；同时，防守方通过头部、衣服的抗暴击与最终减伤词条可把对手的有效暴击率压回 40% 左右，形成攻守对抗。

### 2. 词条品质划分
每条词条在生成时确定品质等级，影响数值范围：

| 词条品质 | 触发条件 | 数值范围示例（以 40 级装备为例） |
| --- | --- | --- |
| 普通 | 中品及以上 | 暴击率 +4%~6%，减伤 +3%~5% |
| 稀有 | 上品及以上 | 暴击率 +6%~9%，减伤 +5%~7% |
| 高级 | 极品及以上 | 暴击率 +9%~12%，减伤 +7%~10% |
| 传奇 | 先天/至宝专属 | 暴击率 +12%~15%，减伤 +10%~12% + 附加特效 |

数值按等级线性成长，最终值 = 基础区间 × (1 + 等级 × 0.02)。

### 3. 词条生成流程
1. 确定词条数量（由品质决定）。
2. 根据装备槽位绑定的词条标签（例如鞋履偏向速度/闪避）设定权重。
3. 从分类池按权重随机抽取，保证至少包含一条与槽位核心定位相关的词条。
4. 对已抽取词条应用品质判断与数值滚动。
5. 若装备达 3 条副属性，最后一条必为“特殊类”或具有唯一效果（如“控制命中时额外延长 1 回合”）。

### 4. 词条交互规则
- 同类词条可叠加，但设置递减系数，例如第二条相同词条效果 ×90%，第三条 ×80%，防止单一属性溢出。
- 部分对立属性设互斥（如“闪避率%”与“命中率%”不可同装于同件装备），强化策略选择。
- **交互示例**：
  - *暴击爆发组合*：武器“最终增伤”主属性 + 副属性“暴击率”“暴击伤害”“连击率”，触发时输出 = 基础伤害 ×(1+暴击伤害)×(1+最终增伤)×连击段数。若再叠加套装追加攻击，可形成瞬时爆发。
  - *肉盾反击组合*：衣服、腰带堆“减伤”“格挡”，护腕、傀儡配置“反击率”，通过递减系数仍可达到 80% 以上综合反击几率，同时利用最终减伤防止被爆发秒杀。
  - *高速控制组合*：鞋履主属性“速度”+宝珠“控制命中”+项圈“控制强度”，搭配“控制命中”副属性；当速度达到环境上限（如 220%），可凭借控制命中 40% 以上叠加成功率，套装则提升持续回合。

## 五、套装系统
延续 2 件套/4 件套结构，增强流派特征。

| 套装 | 2 件套效果 | 4 件套效果 |
| --- | --- | --- |
| 狂暴之影 | 暴击率 +15%，暴击伤害 +25% | 暴击后触发 60% 概率的追加攻击，追加攻击享受 50% 最终增伤，且 5 秒内最终增伤 +10%（不可叠加）。 |
| 不动壁垒 | 生命上限 +22%，减伤 +15% | 受击必定反击（冷却 1 回合），反击伤害 +60%，触发时自身获得 20% 格挡（2 回合）。 |
| 迅疾震慑 | 速度 +22%，控制命中 +18% | 先手施加控制后延长 1 回合；若控制失败，自身立即获得 30% 速度加成和 20% 控制命中（持续 1 回合）。 |
| 圣愈庇护 | 治疗量 +25%，受疗 +15% | 我方获得治疗时赋予 12% 减伤庇护（可叠 3 层），同时敌方受疗 -25%。 |
| 影缚迷踪 | 闪避 +18%，命中 +10% | 闪避成功后 2 秒内速度 +30%，下一次攻击附带 50% 破甲；若命中目标触发控制，延长控制 0.5 回合。 |
| 灼心焚天 | 道法伤害 +20%，最终增伤 +10% | 技能命中时点燃目标，使其在 3 秒内承受额外 12% 最终伤害，并降低其火焰抗性 15%。 |

套装采用“同名装备 2 件/4 件即可激活”逻辑，允许 2+2 混搭或 4 件一体化构筑。套装词条与单件副属性共同计算，但不参与递减系数。

## 六、流派构筑示例
- **暴击爆发流**：武器、护腕、法器优先主属性“基础攻击/最终增伤”，副属性选择暴击、暴伤、连击。配合狂暴之影 4 件，实现多段爆发。
- **肉盾反击流**：衣服、腰带、护腕堆叠减伤、生命与格挡，配不动壁垒 4 件，副属性补足反击率与护盾强度，确保换血优势。
- **高速控制流**：鞋履、法器、项圈主属性锁速度，副属性投入控制命中、控制强度，搭配迅疾震慑 4 件或与影缚迷踪 2 件混搭提升稳定性。
- **治疗辅助流**：腰带、宝珠、项圈主属性选受疗或治疗强化，副属性补受疗、怒气获取，使用圣愈庇护 4 件稳定团队续航。
- **闪避游击流**：鞋履、护腕、秘宝主属性锁闪避，副属性堆闪避、速度、命中，影缚迷踪 4 件提供攻防转换，必要时混搭不动壁垒 2 件提升容错。
- **道法灼烧流**：法器、宝珠、秘宝主属性选法术强度/最终增伤，副属性堆道法伤害、元素易伤，灼心焚天 4 件形成持续压制。

## 七、流派属性矩阵与成长节奏

| 流派 | 核心槽位 | 主属性优先级 | 副属性堆叠顺序 | 关键触发阈值 | 克制手段 |
| --- | --- | --- | --- | --- | --- |
| 暴击爆发流 | 武器、护腕、法器、秘宝 | 基础攻击 ≥ 最终增伤 > 连击率 | 暴击率 → 暴击伤害 → 最终增伤 → 连击率 | 暴击率 80%（含基础）、连击率 30% | 抗暴击、减伤、格挡、闪避 |
| 肉盾反击流 | 衣服、腰带、护腕、傀儡 | 减伤 ≥ 生命% > 格挡率 | 反击率 → 最终减伤 → 护盾强度 → 防御% | 反击率 70%（配合套装达到 100%）、减伤 55% | 爆发秒杀、控制、弱化反击词条 |
| 高速控制流 | 鞋履、宝珠、项圈、法器 | 速度 ≥ 控制命中 > 控制强度 | 速度 → 控制命中 → 控制强度 → 命中 | 速度值 ≥ 环境上限 +15%，控制命中 ≥ 35% | 抗控、速度压制、净化类技能 |
| 治疗辅助流 | 腰带、宝珠、项圈、信物 | 治疗强化 ≥ 受疗 > 生命% | 治疗强化 → 受疗 → 怒气获取 → 减伤 | 治疗强化 50%，受疗 30%，怒气循环 3 回合 | 弱化治疗、爆发集火、持续重伤 |
| 闪避游击流 | 鞋履、护腕、秘宝、信物 | 闪避 ≥ 速度 > 命中 | 闪避 → 速度 → 命中 → 控制命中 | 闪避值 ≥ 环境命中+60（如 280 对 220），速度 ≥ 180% | 命中、必中技能、抗闪光环 |
| 道法灼烧流 | 法器、宝珠、秘宝、武器 | 法术强度 ≥ 最终增伤 > 元素易伤 | 元素易伤 → 最终增伤 → 道法倍率 → 连击 | 易伤叠加 35%、最终增伤 40%、元素抗性穿透 20% | 元素抗性、解 Debuff、治疗护盾 |

为引导玩家成长节奏，每个流派设计 3 个阶段目标：
1. **入门阶段（平均装备品质：中品/上品）**：重点凑齐主属性方向与关键阈值的 60%，例如暴击流先堆到 50% 暴击率，高速流速度达到环境均值。
2. **成型阶段（平均品质：极品/仙品）**：通过第二条副属性与 2 件套效果补齐阈值，并开始追求克制属性。例如反击流在此阶段追求 55% 减伤与 60% 反击率。
3. **极限阶段（平均品质：完美以上）**：利用传奇词条与 4 件套构建差异化，例如高速控制在极限阶段可借传奇词条让控制延长 2 回合，并通过秘宝唯一词条降低对方抗控。

## 八、数值平衡与对策
1. **攻防对抗**：暴击与暴伤可通过抗暴击、减伤等词条克制；反击流面对爆发输出需依赖格挡与最终减伤。
2. **速度博弈**：速度词条提升行动频率，但高抗控与稳定护盾可降低被先手瓦解的风险。
3. **命中与闪避**：命中、控制命中与闪避成对抗关系；递减系数与互斥规则保证需要投入成本才能达到阈值。
4. **治疗与压制**：治疗强化与受疗加成提升续航，对应的弱化治疗、重创词条则提供压制手段。
5. **特殊流派平衡**：传奇词条多附带冷却或触发条件，避免一次性碾压；至宝装备的唯一词条需设定严格前置条件（如每战斗仅触发 1 次）。

## 九、装备生成总流程
1. **确定槽位、等级与品质**。
2. **生成主属性**：按槽位候选池选取并计算最终数值。
3. **计算副属性数量并抽取词条**：遵循词条池、品质限制与互斥规则。
4. **附加套装信息**（若装备属于特定系列）。
5. **记录唯一标识**：包括词条品质、随机浮动值，为后续强化或洗练做准备。

## 结语
本次重构方案在不考虑爆率的前提下，明确了装备的槽位定位、品质梯度、主副属性生成规则与套装协同逻辑，为后续拓展掉落、锻造、洗练等系统奠定坚实基础。通过差异化的词条组合与成套加成，玩家可在同一框架内打造个性化的战斗流派，持续探索最佳解与克制关系。

## 十、实现与运维说明

### 1. 代码映射速览
- 槽位、品质、词条与套装的全部配置集中在 `cloudfunctions/pve/index.js` 顶部：
  - `EQUIPMENT_SLOTS` 记录 12 个槽位的主属性候选、权重与词条标签。【F:cloudfunctions/pve/index.js†L120-L213】
  - `EQUIPMENT_QUALITY_CONFIG` 定义凡品至至宝九档品质的主属性系数、允许的词条段位与配色，代码里对应的键分别是 `mortal`、`inferior`、`standard`、`superior`、`excellent`、`immortal`、`perfect`、`primordial`、`relic`。【F:cloudfunctions/pve/index.js†L215-L233】
  - `EQUIPMENT_ATTRIBUTE_RULES` 与 `EQUIPMENT_AFFIX_RULES` 列举所有基础与战斗属性的成长斜率、精度与标签，驱动 `calculateEquipmentStats` 的主/副属性数值结算。【F:cloudfunctions/pve/index.js†L241-L321】
  - `EQUIPMENT_SET_LIBRARY` 描述六大套装的 2/4 件效果，并在 `sumEquipmentBonuses` 中统一结算加成与提示文字。【F:cloudfunctions/pve/index.js†L323-L410】【F:cloudfunctions/pve/index.js†L2580-L2624】
  - `EQUIPMENT_LIBRARY` 列表即本次上线的全量装备，包含新手 12 件基础装、六大套装成员以及传奇装备，均使用上述配置生成主副属性与特效。【F:cloudfunctions/pve/index.js†L412-L692】

### 2. 数值计算路径
- `calculateEquipmentStats` 会基于品质系数、槽位系数、词条段位等因素生成主属性、各条副属性与唯一特效，并统一写入 `stats`、`mainAttribute`、`subAttributes` 等字段供前端展示。【F:cloudfunctions/pve/index.js†L2726-L2802】
- `sumEquipmentBonuses` 在角色结算时遍历所有装备，累加基础属性、战斗属性、多乘算词条以及套装效果，同时收集装备与套装描述文字，最终输出到 `equipmentBonus`。【F:cloudfunctions/pve/index.js†L2580-L2624】
- 战斗力计算新增了连击率、反击率、护盾强度、元素易伤等权重，使新引入的战斗属性能够正确影响数值评估。【F:cloudfunctions/pve/index.js†L2927-L2966】
- `decorateEquipment` 复用 `equipmentBonus` 以返回 `bonus.sets` 与 `bonus.notes`，支持前端直接展示套装触发情况与特性说明。【F:cloudfunctions/pve/index.js†L2992-L3015】
- `formatBattleResult` 的装备掉落改为输出 `quality`、`qualityLabel`、`qualityColor`，确保战斗日志与新品质体系保持一致。【F:cloudfunctions/pve/index.js†L3738-L3768】

### 3. 使用指引
- 小程序「角色」页的“装备”页签会列出 12 个槽位与背包装备。每件装备会显示主属性、副属性、特效以及所属套装，颜色与标签基于 `quality` 字段自动匹配。【F:miniprogram/pages/role/index.wxml†L120-L174】
- 新增的“已激活套装”“装备特性”摘要区块读取 `bonus.sets`、`bonus.notes`，便于玩家在界面中查看套装效果与特效描述。【F:miniprogram/pages/role/index.wxml†L175-L198】
- 玩家通过“装备”按钮即可替换当前槽位；装备上阵后，`profile.attributes` 中的 `equipmentBonus` 会附带 `sets` 与 `notes`，便于后续在面板或战斗日志中展示套装详情。【F:cloudfunctions/pve/index.js†L1424-L1452】【F:cloudfunctions/pve/index.js†L2580-L2624】

### 4. 扩展与维护
- **新增装备**：在 `EQUIPMENT_LIBRARY` 追加条目并指定 `slot`、`quality`、`mainAttribute`、`subAttributes`、`uniqueEffects`、`setId` 即可。若引入新的词条或槽位，需同步更新 `EQUIPMENT_ATTRIBUTE_RULES`/`EQUIPMENT_AFFIX_RULES` 或 `EQUIPMENT_SLOTS`。【F:cloudfunctions/pve/index.js†L241-L321】【F:cloudfunctions/pve/index.js†L412-L692】
- **新增套装**：向 `EQUIPMENT_SET_LIBRARY` 添加配置并在 `EQUIPMENT_LIBRARY` 中让相关装备引用新的 `setId`，即可自动触发 2/4 件加成与提示文字。【F:cloudfunctions/pve/index.js†L323-L373】
- **调整数值**：主属性、词条成长与品质系数均集中在上述常量中，无需修改核心逻辑函数即可完成平衡性调优。

### 5. 部署流程
- 云函数：在微信开发者工具中打开 `cloudfunctions/pve`，运行上传部署即可将装备结算逻辑同步到云端。
- 小程序前端：重新编译并上传 `miniprogram` 目录即可获得新的装备展示与操作界面。本次改造未引入额外依赖，不需要额外安装步骤。
