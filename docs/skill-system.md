# 《寻道大千》技能系统重构方案

## 1. 设计目标
- **建立清晰的技能架构**：重新梳理主动/被动技能、流派类别与元素属性，使战斗职责明晰。
- **强化数值成长路径**：统一冷却、资源消耗、效果数值与成长机制的定义，为后续平衡与拓展奠定基础。
- **塑造品质梯度体验**：通过灵感、开辟、通玄、悟道四个品质段提供由浅入深的玩法体验，驱动玩家长期追求。
- **突出流派差异化**：根据剑修、法修、体修、御兽、符箓等主流路线设计技能模板，确保玩法深度与策略性。
- **融入元素特色**：以火、雷、水、木、土、毒六系为核心，让元素效果成为战斗决策的重要变量。

## 2. 技能基础结构

### 2.1 技能类型
| 类型 | 触发方式 | 核心作用 | 典型示例 |
| --- | --- | --- | --- |
| 主动技能 | 战斗中手动释放，受冷却限制 | 造成直接伤害、提供即时增益或控制 | 狮子吼（降低敌方全属性）、掌心雷（高爆发雷击） |
| 被动技能 | 条件满足时自动触发 | 提供持续增益、状态免疫、额外攻击等 | 解尸法（倒地后原地复活一次）、护体金光（护盾+恢复） |

> **设计要点**：主动技能需明确施放条件、冷却与资源消耗；被动技能强调触发条件与持续收益，避免与主动技能职责重叠。

### 2.2 统一属性模板
每个技能数据结构应包含：
- **基础信息**：名称、类型（主动/被动）、流派类别、元素属性、品质、技能等级上限。
- **施放参数**：冷却（或回合间隔）、真气消耗、施放距离/范围、施放前摇与后摇（若适用）。
- **核心效果**：伤害/治疗倍率、增益/减益数值、持续时间、目标数量。
- **附加机制**：状态效果（眩晕、冰冻、灼烧等）、触发概率、连锁条件（如剑意层数、灵兽行动）。
- **成长规则**：等级提升带来的数值增长、解锁印记槽位、品质突破条件。
- **兼容性信息**：与装备、灵兽、符箓等系统的联动说明，确保跨系统协同。

### 2.3 印记槽位规则
- 灵感、开辟品质：25级解锁第1个印记槽，无法开启第二槽。
- 通玄品质：25级解锁第一槽，50级后开放第二槽（需突破材料）。
- 悟道品质：25级第一槽，40级解锁第二槽，50级可额外开启专属符印（第三槽，提供变体效果）。

## 3. 技能品质梯度

| 品质 | 获取难度 | 数值强度 | 机制复杂度 | 成长上限 | 典型设计 |
| --- | --- | --- | --- | --- | --- |
| 灵感 | 低 | 基础倍率（100%~120%攻击）、单一增益 | 纯粹效果，无额外触发 | Lv.25 | 提高一次普攻伤害；小幅增速 |
| 开辟 | 中 | 中等倍率（130%~150%攻击）、附带单一状态 | 简易触发（如命中后减速） | Lv.35 | 附加减速或护盾；缩短灵兽CD |
| 通玄 | 高 | 高倍率（160%~200%攻击）、双效果 | 多段触发/条件（剑意、叠毒） | Lv.50，两槽 | 多段连斩、持续灼烧、反震 |
| 悟道 | 极高 | 顶级倍率（210%以上）+复合增益 | 多重触发、概率爆发、战局扭转 | Lv.50，专属符印 | 暴击多重触发、群控+易伤、复活链 |

### 3.1 品质颜色规范

| 品质 | 色值（Hex） | 备注 |
| --- | --- | --- |
| 灵感 | `#6C8CFF` | 用于灵感类技能标题与提示文本 |
| 开辟 | `#45C0A8` | 用于开辟类技能标题与提示文本 |
| 通玄 | `#B281FF` | 用于通玄类技能标题与提示文本 |
| 悟道 | `#F2A546` | 用于悟道类技能标题与提示文本 |

> **数值平衡指引**：高品质技能在基础数值上的提升应控制在同级装备约20%~30%的差距，真正体现强度差异的应是复合机制与成长空间。

## 4. 元素属性设定

| 元素 | 主定位 | 常见附加效果 | 战术应用 |
| --- | --- | --- | --- |
| 火 | 持续伤害、易伤 | 灼烧、易伤、护甲破坏 | 配合高频攻击/团队爆发提升总伤 |
| 雷 | 瞬间爆发、短控 | 眩晕、麻痹、打断 | 先手秒杀、打断读条技能 |
| 水 | 控场、辅助 | 减速、冰冻、治疗、解负面 | 拖延、保护队友、控制敌方节奏 |
| 木 | 回复、束缚 | 治疗、护盾、缠绕、增益 | 团队辅助、属性强化 |
| 土 | 防守、减速 | 护甲、护盾、石化、减攻速 | 承伤站场、削弱敌群 |
| 毒 | 持久压制、削弱 | 中毒、腐蚀、降低抗性/攻击 | 拉长战斗、拖垮高防敌人 |

> **联动规则**：
> - 元素组合可触发额外效果，如先施加水系减速后使用雷系技能可增加眩晕概率10%。
> - 毒与火叠加时，中毒目标每回合额外受到火属性真实伤害（基于火攻10%）。
> - 土系护盾可抵消毒系伤害的前两跳，强化克制关系。

## 5. 流派技能框架

### 5.1 剑修（单体爆发）
- **共性**：高单体倍率、剑意层数驱动、暴击/连斩触发。
- **资源特征**：中等冷却+较低真气消耗，鼓励连续输出。
- **设计模板**：
  - *灵感*：+X%攻击的剑气斩；
  - *通玄*：消耗剑意触发多段伤害，若击杀则刷新冷却；
  - *悟道*：暴击后追加剑雨（多段斩击）+穿透防御。

### 5.2 法修（远程群攻）
- **共性**：范围道法、元素多样、冷却较长。
- **资源特征**：高真气消耗，高收益AOE。
- **设计模板**：
  - *灵感*：单线火球/冰箭。
  - *通玄*：覆盖多格的阵法，附带元素控制。
  - *悟道*：大范围连锁（如雷链、火阵）+元素联动奖励。

### 5.3 体修（防御续航）
- **共性**：减伤、护盾、恢复、免死触发。
- **资源特征**：多数被动或长冷却主动，真气消耗低。
- **设计模板**：
  - *灵感*：短时间减伤或小幅自疗。
  - *通玄*：多层护盾+反震伤害。
  - *悟道*：生命阈值触发免死+群体嘲讽+燃烧反击。

### 5.4 御兽（灵兽联动）
- **共性**：增强灵兽、共享行动收益、触发协同。
- **资源特征**：部分技能作用于灵兽冷却、攻速。
- **设计模板**：
  - *灵感*：提升灵兽攻击/防御，缩短技能CD。
  - *通玄*：灵兽施法追加主人增益或再次行动。
  - *悟道*：灵兽与主人互相触发爆发（例如灵兽击杀刷新主人主动技能）。

### 5.5 符箓（控制辅助）
- **共性**：控制、封印、削弱、增益，伤害适中。
- **资源特征**：冷却中等，真气消耗取决于效果强度。
- **设计模板**：
  - *灵感*：单体减防/定身短控。
  - *通玄*：群体封印/属性吸取。
  - *悟道*：多重控制+团队增益或战局逆转（如群体复活护盾）。

## 6. 技能示例库

### 6.1 低品质技能（灵感 / 开辟）
| 名称 | 品质 | 类型 | 流派 / 元素 | 核心效果 | 成长 & 备注 |
| --- | --- | --- | --- | --- | --- |
| 破云斩 | 灵感 | 主动 | 剑修 / 无 | 120%攻击对单体造成伤害；若暴击，额外造成30%伤害 | 每级+4%伤害；25级解锁1槽 |
| 烈炽火弹 | 灵感 | 主动 | 法修 / 火 | 100%法攻火球命中后附加2回合灼烧（每回合20%法攻） | 每级灼烧+2%；冷却3回合 |
| 凝霜矢 | 开辟 | 主动 | 法修 / 水 | 130%法攻冰箭并减速30%持续2回合 | 每级伤害+3%，减速+1% |
| 铜皮诀 | 灵感 | 被动 | 体修 / 土 | 受击时减伤8%，持续一回合，冷却3回合 | 每级减伤+0.5% |
| 焚血激 | 开辟 | 主动 | 体修 / 火 | 自身回复15%生命并获得10%反震伤害，持续2回合 | 每级回复+1%、反震+1% |
| 灵契术 | 灵感 | 主动 | 御兽 / 木 | 灵兽攻击力+15%，持续3回合 | 每级+1%，冷却4回合 |
| 兽魂鼓 | 开辟 | 被动 | 御兽 / 雷 | 灵兽释放技能后，主人回复5%真气 | 每级+0.3%，冷却2回合 |
| 定神符 | 灵感 | 主动 | 符箓 / 雷 | 眩晕单体1回合，命中率80% | 每级命中+2%，冷却5回合 |
| 蚀骨符 | 开辟 | 主动 | 符箓 / 毒 | 降低敌方10%防御，持续3回合，并附加每回合10%中毒 | 每级防御降低+0.5% |
| 虚神息 | 开辟 | 被动 | 符箓 / 水 | 自身真气上限+10%，回合结束回复1%真气 | 每级上限+1% |

### 6.2 高品质技能（通玄 / 悟道）
| 名称 | 品质 | 类型 | 流派 / 元素 | 核心效果 | 成长 & 备注 |
| --- | --- | --- | --- | --- | --- |
| 千刃星陨 | 通玄 | 主动 | 剑修 / 雷 | 消耗3层剑意，对单体连续斩击4次（每次70%攻击）；若目标被击败，刷新冷却 | 每级每段+3%，冷却4回合 |
| 戮仙剑域 | 悟道 | 主动 | 剑修 / 无 | 开启剑域3回合，普攻与技能额外触发剑气（50%攻击），暴击时生成剑意 | 每级剑气+2%，第二槽提供穿透 |
| 离火焚天 | 通玄 | 主动 | 法修 / 火 | 大范围火阵造成180%法攻并附3回合易伤（+15%所受伤害），灼烧每回合30%法攻 | 每级伤害+4%，易伤+1% |
| 万雷劫链 | 悟道 | 主动 | 法修 / 雷 | 对首目标造成220%法攻，连锁至最多5名敌人，每次命中附1回合眩晕（基础40%几率） | 每级伤害+5%，眩晕+3% |
| 金刚不灭 | 通玄 | 被动 | 体修 / 土 | 生命低于35%触发护体：减伤40%、每回合恢复10%生命，持续3回合，冷却6回合 | 每级减伤+2%，恢复+1% |
| 焚世熔炉 | 悟道 | 主动 | 体修 / 火 | 生成火焰护盾吸收等同40%生命的伤害并对近战者反射20%真实灼烧，护盾破裂时对周围造成250%火伤 | 每级护盾+3%、反射+1% |
| 玄兽同心 | 通玄 | 被动 | 御兽 / 木 | 灵兽攻击时给主人叠加“同心”层（攻速+5%、真气回复+5%），最高5层；灵兽倒地后保留1层 | 每级加成+0.5% |
| 帝御九霄 | 悟道 | 主动 | 御兽 / 雷 | 召唤灵兽连携：灵兽立即行动一次并获得狂暴（伤害+40%、技能冷却-1），主人下次主动技能造成额外100%伤害 | 每级狂暴+2%，额外伤害+5% |
| 镇魂神符 | 通玄 | 主动 | 符箓 / 水 | 对全体敌人施加沉默2回合并降低20%真气恢复，命中率70% | 每级命中+2%，减真气+2% |
| 太乙护界 | 悟道 | 主动 | 符箓 / 土 | 为全体队友施加护界（吸收30%生命护盾+20%全属性抗性），持续3回合；期间每当队友受控，自动解除并反射控制者 | 每级护盾+2%、抗性+1%，专属符印解锁群体复活 |

### 6.3 中阶品质扩展示例（开辟 / 通玄）
| 名称 | 品质 | 类型 | 流派 / 元素 | 核心效果 | 成长 & 备注 |
| --- | --- | --- | --- | --- | --- |
| 流光剑步 | 开辟 | 主动 | 剑修 / 雷 | 迅疾突进至目标身后造成140%攻击伤害，并使自身敏捷+12%，持续2回合 | 每级伤害+3%，敏捷加成+0.5%，冷却4回合 |
| 烈羽焚锋 | 开辟 | 主动 | 剑修 / 火 | 对前方两格敌人各造成135%攻击并附加2回合灼烧（每回合15%攻击） | 每级伤害+3%，灼烧+1%，命中目标数不变 |
| 凌霜定潮 | 开辟 | 主动 | 法修 / 水 | 小范围寒潮造成130%法攻并降低目标20%攻速，持续2回合 | 每级伤害+2%，减速+1%，冷却4回合 |
| 灼脉流炬 | 开辟 | 主动 | 法修 / 火 | 直线火焰造成145%法攻，若命中灼烧目标额外造成30%瞬时伤害 | 每级基础伤害+3%，额外伤害+2%，真气消耗中等 |
| 岩嵯坚体 | 开辟 | 被动 | 体修 / 土 | 受到暴击时触发岩甲：减伤25%并回复8%生命，持续1回合，冷却3回合 | 每级减伤+1%，回复+0.5%，25级解锁印记槽 |
| 熔血怒元 | 开辟 | 主动 | 体修 / 火 | 立即回复12%生命并获得15%反震，持续2回合；期间被攻击者额外承受10%火伤 | 每级回复+0.8%，反震+1%，火伤+0.5% |
| 木灵惠泽 | 开辟 | 主动 | 御兽 / 木 | 灵兽立即回复18%生命并获得治疗量+20%，持续3回合 | 每级治疗加成+1%，冷却5回合，真气消耗较低 |
| 雷驭号令 | 开辟 | 被动 | 御兽 / 雷 | 灵兽释放技能后使主人下次主动技能冷却缩短1回合，冷却3回合 | 每级冷却缩短额外-0.1回合（向下取整），最多减少至2回合 |
| 断厄符索 | 开辟 | 主动 | 符箓 / 毒 | 对单体造成120%法攻并施加毒索：降低其妖气回复20%，持续3回合 | 每级伤害+2%，回复降低+1%，命中率基础90% |
| 清魂定印 | 开辟 | 被动 | 符箓 / 水 | 回合结束若自身未受控，回复3%真气并清除1层减益，冷却2回合 | 每级真气恢复+0.2%，冷却固定 |
| 雷霆断界 | 通玄 | 主动 | 剑修 / 雷 | 消耗2层剑意对单体连击3次（每次60%攻击），并有50%几率眩晕1回合 | 每级每段+4%，眩晕概率+2%，冷却4回合 |
| 焚霞御剑 | 通玄 | 被动 | 剑修 / 火 | 暴击时附加剑炎标记，目标在下一次受击时额外承受70%攻击火伤 | 每级附加伤害+4%，标记持续2回合，冷却2回合 |
| 霜渊天缚 | 通玄 | 主动 | 法修 / 水 | 召唤冰棱阵造成170%法攻并冻结2回合（基础60%命中），冻结目标破冰时受到额外40%法攻 | 每级伤害+4%，冻结命中+2%，冷却5回合 |
| 灼阳星墟 | 通玄 | 主动 | 法修 / 火 | 小范围爆燃造成180%法攻并附加3回合易伤（+12%所受伤害），自身获得1层火势（法攻+5%） | 每级伤害+4%，易伤+1%，火势层数上限3 |
| 玄石擎壁 | 通玄 | 被动 | 体修 / 土 | 生命低于50%时生成擎壁护盾，吸收自身30%生命并反射15%土伤，持续2回合，冷却5回合 | 每级护盾+2%，反射+1%，护盾破裂对周围造成土溅射 |
| 炎魂蔽天 | 通玄 | 主动 | 体修 / 火 | 开启2回合炎魂状态：减伤25%，对近战者造成每回合60%火系反击，并回复5%生命 | 每级减伤+1%，反击+3%，回复+0.5% |
| 同脉灵契 | 通玄 | 被动 | 御兽 / 木 | 灵兽攻击命中后给主人与灵兽各回复4%真气并共享增益持续时间+1回合，冷却3回合 | 每级回复+0.3%，共享增益最多延长至3回合 |
| 电翎急袭 | 通玄 | 主动 | 御兽 / 雷 | 命令灵兽立即行动并造成两段雷击（各75%攻击），若目标被眩晕则额外连锁至1名敌人 | 每级伤害+3%，连锁伤害100%继承，冷却4回合 |
| 九宫封煞 | 通玄 | 主动 | 符箓 / 土 | 在目标区域布置九宫结界：范围敌人减速40%、防御-15%，持续2回合，并禁锢被结界击败的首个敌人 | 每级减速+1%，防御降低+0.5%，结界持续时间固定 |
| 灭脉蚀心 | 通玄 | 被动 | 符箓 / 毒 | 对中毒敌人造成伤害时附加一层“蚀心”（受治疗-20%，持续2回合），冷却2回合 | 每级治疗压制+1%，印记可改为延长中毒时长 |

### 6.4 技能等级成长公式

> 所有技能的核心数值遵循统一公式：`实际值 = 基础值 + (Lv-1) × 每级成长`。下列数据按品质展示关键成长参数与满级表现，概率在战斗中会受系统上限限制。

#### 灵感品质（Lv25 上限）
- **破云斩**：主倍率 = 120% + 4%×(Lv-1)，Lv25 达 216%；暴击追加 = 30% + 2%×(Lv-1)，Lv25 达 78%。
- **烈炽火弹**：命中倍率 = 100% + 2%×(Lv-1)，Lv25 为 148%；灼烧伤害 = 20% + 2%×(Lv-1) 每回合，Lv25 为 68%/回合（持续 2 回合）。
- **铜皮诀**：触发减伤 = 8% + 0.5%×(Lv-1)，Lv25 可减伤 20%（持续 1 回合，冷却 3 回合）。
- **灵契术**：灵兽攻击力加成 = 15% + 1%×(Lv-1)，Lv25 提升至 39%（持续 3 回合）。
- **定神符**：眩晕命中率 = 80% + 2%×(Lv-1)，Lv25 理论命中 128%，战斗按 100% 上限结算（持续 1 回合）。

#### 开辟品质（Lv35 上限）
- **凝霜矢**：命中倍率 = 130% + 3%×(Lv-1)，Lv35 为 232%；减速幅度 = 30% + 1%×(Lv-1)，Lv35 可压制 64%。
- **焚血激**：即时回复 = 15% + 1%×(Lv-1)，Lv35 回复 49%；反震比例 = 10% + 1%×(Lv-1)，Lv35 反震 44%。
- **兽魂鼓**：触发回复 = 5% + 0.3%×(Lv-1)，Lv35 为 15.2%，触发冷却固定 2 回合。
- **蚀骨符**：防御降低 = 10% + 0.5%×(Lv-1)，Lv35 降低 27%；中毒 = 10% + 0.5%×(Lv-1) 每回合，Lv35 为 27%/回合（持续 3 回合）。
- **虚神息**：真气上限 = 10% + 1%×(Lv-1)，Lv35 提升 44%；回合末额外回复固定 1% 真气。
- **流光剑步**：命中倍率 = 140% + 3%×(Lv-1)，Lv35 为 242%；敏捷加成 = 12% + 0.5%×(Lv-1)，Lv35 提升 29%。
- **烈羽焚锋**：单格倍率 = 135% + 3%×(Lv-1)，Lv35 为 237%；灼烧 = 15% + 1%×(Lv-1) 每回合，Lv35 为 49%/回合（持续 2 回合，覆盖 2 个目标）。
- **凌霜定潮**：命中倍率 = 130% + 2%×(Lv-1)，Lv35 为 198%；攻速降低 = 20% + 1%×(Lv-1)，Lv35 可压制 54%。
- **灼脉流炬**：基础倍率 = 145% + 3%×(Lv-1)，Lv35 为 247%；灼烧目标追加 = 30% + 2%×(Lv-1)，Lv35 可追加 98%。
- **岩嵯坚体**：触发减伤 = 25% + 1%×(Lv-1)，Lv35 达 59%；生命回复 = 8% + 0.5%×(Lv-1)，Lv35 为 25%。
- **熔血怒元**：即时回复 = 12% + 0.8%×(Lv-1)，Lv35 为 39.2%；反震比例 = 15% + 1%×(Lv-1)，Lv35 为 49%；额外火伤 = 10% + 0.5%×(Lv-1)，Lv35 为 27%。
- **木灵惠泽**：即时治疗 = 18% + 0.8%×(Lv-1)，Lv35 为 45.2%；治疗量加成 = 20% + 1%×(Lv-1)，Lv35 为 54%。
- **雷驭号令**：触发冷却缩减 = -1 - 0.1×(Lv-1) 回合，Lv35 理论 -4.4 回合，实际按向下取整与 -2 上限执行；触发间隔固定 3 回合。
- **断厄符索**：命中倍率 = 120% + 2%×(Lv-1)，Lv35 为 188%；妖气回复压制 = 20% + 1%×(Lv-1)，Lv35 使敌方回复-54%（持续 3 回合）。
- **清魂定印**：回合回复 = 3% + 0.2%×(Lv-1)，Lv35 为 9.8%；触发冷却固定 2 回合。

#### 通玄品质（Lv50 上限）
- **千刃星陨**：单段倍率 = 70% + 3%×(Lv-1)，Lv50 每段 217%，共 4 段。
- **离火焚天**：命中倍率 = 180% + 4%×(Lv-1)，Lv50 为 376%；易伤幅度 = 15% + 1%×(Lv-1)，Lv50 为 64%；灼烧 = 30% + 1.5%×(Lv-1) 每回合，Lv50 为 103.5%/回合。
- **金刚不灭**：触发减伤 = 40% + 2%×(Lv-1)，Lv50 理论 138%（战斗按减伤软上限处理）；回合回复 = 10% + 1%×(Lv-1)，Lv50 为 59%/回合。
- **玄兽同心**：每层攻速/回气 = 5% + 0.5%×(Lv-1)，Lv50 单层 29.5%，可叠 5 层。
- **镇魂神符**：沉默命中率 = 70% + 2%×(Lv-1)，Lv50 为 168%（受命中上限限制）；真气压制 = 20% + 2%×(Lv-1)，Lv50 为 -118%。
- **雷霆断界**：单段倍率 = 60% + 4%×(Lv-1)，Lv50 为 256%；眩晕命中率 = 50% + 2%×(Lv-1)，Lv50 为 148%（按 100% 上限执行）。

## 7. 技能亮点展示规则

### 7.1 分类字典

为了在前端突出技能的关键卖点，后端为所有成长型数值建立了标准化的“亮点类别”。主要类别如下：

| 类别 | 标签 | 典型效果 |
| --- | --- | --- |
| 伤害 | `damage` | 主倍率、附加剑气、破冰伤害、护盾爆裂等直接输出 |
| 暴击 | `crit` | 暴击追加伤害、暴击率提升 |
| 持续伤害 | `dot` | 灼烧、中毒、火势叠层等按回合结算的伤害 |
| 减速 | `slow` | 攻速/移速压制、范围减速 |
| 控制 | `control` | 眩晕、冻结、沉默等命中率与持续时长 |
| 防御 | `defense` | 减伤、抗性、防御属性的提升或削减 |
| 护盾 | `shield` | 护盾吸收、护盾强度 |
| 反击 | `reflect` | 反震、反击伤害、反射灼烧 |
| 治疗 | `heal` | 即时治疗、治疗量加成 |
| 续航 | `sustain` | 每回合回复、生命偷取、真气续航 |
| 资源 | `resource` | 真气上限、回气/妖气回复、冷却缩短 |
| 增益 | `buff` | 攻速、攻击、灵兽伤害等正向属性 |
| 削弱 | `debuff` | 防御降低、治疗压制、易伤幅度 |
| 辅助 | `support` | 增益延长、召唤/协同类效果 |
| 机制 | `mechanic` | 连击段数、目标数量、层数上限等结构性信息 |
| 属性 | `attribute` | 体质、力量等基础属性成长 |
| 闪避 | `evasion` | 闪避类能力与相关乘区 |

所有类别均由 `SKILL_HIGHLIGHT_CATEGORY_LABELS` 映射为中文文案，确保客户端渲染一致性。

### 7.2 文案模板

每条成长曲线都会绑定一个模板（见 `SKILL_PROGRESSION_HIGHLIGHT_MAP`），模板以 `{value}` 作为占位符，由后端按当前等级计算后注入。例如：

- 主倍率 → `造成 {value} 攻击伤害`
- 减速幅度 → `减速 {value}`（自动取绝对值）
- 真气上限 → `真气上限提升 {value}`

针对拥有正负号或每级缩减的属性（例如冷却缩短、防御降低），模板会自动对数值取绝对值并输出符合中文语境的描述。

### 7.3 数值计算

亮点展示统一遵循等级公式：`当前值 = base + (level - 1) × perLevel`。渲染时：

1. 依据技能当前等级计算实时值，并按格式（百分比、整型、每回合等）输出。
2. 若存在成长信息（如“每级+X%”、“满级Y%”），仍保留在技能详情的成长列表中，亮点卡片只展示当下值。
3. 当技能没有匹配的模板时，会回退至通用的成长文本，确保旧技能也能显示实时数值。

### 7.4 前端呈现

- 技能卡片展示亮点数组的首条内容，带有 `【类别】` 前缀，突出技能定位。
- 技能弹窗展示完整亮点、成长详情、数值面板，全部数值均与当前等级实时同步。
- 基础属性、额外伤害等由被动加成提供的统计，会通过 `formatStatsText` 生成并自动贴上对应类别标签。

该机制使得技能页面在升级后无需刷新即可展示新数值，同时也为后续新增技能提供统一的模板与分类依据。
- **霜渊天缚**：命中倍率 = 170% + 4%×(Lv-1)，Lv50 为 366%；冻结命中率 = 60% + 2%×(Lv-1)，Lv50 为 158%（受上限控制）；破冰额外 = 40% + 2%×(Lv-1)，Lv50 为 138%。
- **灼阳星墟**：命中倍率 = 180% + 4%×(Lv-1)，Lv50 为 376%；易伤 = 12% + 1%×(Lv-1)，Lv50 为 61%；火势每层加成 = 5% + 0.5%×(Lv-1)，Lv50 单层 29.5%（上限 3 层）。
- **玄石擎壁**：护盾吸收 = 30% + 2%×(Lv-1)，Lv50 为 128%；反射 = 15% + 1%×(Lv-1)，Lv50 为 64%。
- **炎魂蔽天**：减伤幅度 = 25% + 1%×(Lv-1)，Lv50 为 74%；反击伤害 = 60% + 3%×(Lv-1)，Lv50 为 207%/回合；回合回复 = 5% + 0.5%×(Lv-1)，Lv50 为 29.5%/回合。
- **同脉灵契**：触发回气 = 4% + 0.3%×(Lv-1)，Lv50 为 18.7%；增益延长 = 1 + 0.2×(Lv-1) 回合，Lv50 理论 10.8 回合，战斗按延长 3 回合上限处理；触发冷却 3 回合。
- **电翎急袭**：单段倍率 = 75% + 3%×(Lv-1)，Lv50 为 222%，共两段，并可在眩晕目标间连锁。
- **九宫封煞**：减速幅度 = 40% + 1%×(Lv-1)，Lv50 为 89%；防御削减 = 15% + 0.5%×(Lv-1)，Lv50 为 39.5%。
- **灭脉蚀心**：治疗压制 = 20% + 1%×(Lv-1)，Lv50 为 69%。

## 附录：控制效果一览

| 控制类型 | 战斗提示 | 行动影响 |
| --- | --- | --- |
| 眩晕（`stun`） | 眩晕 | 跳过本回合行动，无法普攻、无法释放主动攻击技能，且无法闪避后续攻击。 |
| 冰冻（`freeze`） | 冰冻 | 跳过行动，无法普攻、无法释放主动技能、无法闪避；遭遇火系攻击时立即解除，并仅承受 10% 火系伤害。 |
| 沉睡（`sleep`） | 陷入沉睡 | 无法普攻、无法释放主动技能、无法闪避；每回合额外回复 10 点真气；受到任意伤害立即惊醒并清除沉睡。 |
| 沉默（`silence`） | 沉默 | 保留普攻与闪避能力，但禁止释放所有主动攻击技能。 |
> 注：当出现未知的控制效果类型时，系统默认按“眩晕”处理，以保证战斗结算的确定性与安全性。
>
> 确认命中会带来眩晕、冰冻、沉睡等“禁闪避”控制时，命中公式会在本次技能的后续段落与追击判定中立即屏蔽闪避检定，避免同一技能的剩余打击仍然被闪避。

#### 悟道品质（Lv50 上限）
- **戮仙剑域**：剑气附加倍率 = 50% + 2%×(Lv-1)，Lv50 为 148%，领域持续 3 回合。
- **万雷劫链**：命中倍率 = 220% + 5%×(Lv-1)，Lv50 为 465%；眩晕命中率 = 40% + 3%×(Lv-1)，Lv50 为 187%（战斗按 100% 上限判定）。
- **焚世熔炉**：护盾吸收 = 40% + 3%×(Lv-1)，Lv50 为 187%；反射灼烧 = 20% + 1%×(Lv-1)，Lv50 为 69%；护盾爆裂 = 250% + 5%×(Lv-1)，Lv50 为 495%。
- **帝御九霄**：灵兽伤害加成 = 40% + 2%×(Lv-1)，Lv50 为 138%；主人下次技能增伤 = 100% + 5%×(Lv-1)，Lv50 为 345%；灵兽技能冷却固定缩短 1 回合。
- **太乙护界**：护盾吸收 = 30% + 2%×(Lv-1)，Lv50 为 128%；抗性提升 = 20% + 1%×(Lv-1)，Lv50 为 69%，持续 3 回合并附带净化反射。

上述成长曲线可直接套入计算公式，并已同步写入技能数值配置与 `progressionSummary` 展示逻辑，确保数值成长与战斗结算一致。


## 7. 数值与平衡流程
1. **技能原型制定** → 由策划根据流派模板填写属性数据表。
2. **内部模拟验证** → 使用战斗模拟器测试DPS、治疗、控制覆盖率，确保同品质技能在各流派之间的效率接近。
3. **印记与装备联动测试** → 检查技能与装备词缀、灵兽特性、符印的协同性，防止叠加过度。
4. **玩家体验测试** → 选取代表性关卡（单体BOSS、群怪副本、PVP）验证技能组合表现。
5. **数据迭代** → 根据测试反馈调整冷却、概率、叠层上限，保证技能有显著特色但不过度碾压。

## 8. 后续拓展建议
- **技能树系统**：依据流派设计分支节点（输出/控制/生存），让玩家在技能升级时选择分支强化，形成差异化 BD。
- **元素共鸣玩法**：为特定元素组合加入组合技或额外效果（如火+毒的炼狱爆裂）。
- **符印自定义**：高品质技能的印记槽可镶嵌“变体符印”，提供数值替换或效果扩展（如将雷系眩晕改为麻痹+减速）。
- **技能进化任务**：通过剧情或挑战任务解锁技能进化，提升技能品质或开启新机制，强化投入感。
- **战斗日志可视化**：新增技能触发、元素联动的战斗日志展示，帮助玩家理解技能价值与搭配策略。

## 9. 战斗流程与操作模式
- **15 回合限制**：战斗须在 15 回合内分出胜负，超时则比较双方剩余生命决定结果，低血方判负。设计技能时需考虑输出节奏，避免拖延型技能导致超时，也要在数值上鼓励玩家在 12~14 回合内结束战斗。
- **半自动操作**：默认支持全自动战斗（自动普攻、自动施放技能、自动更换装备），核心技能保留手动释放窗口。玩家可在关键节点切换为手动释放主角道法，以便在 BOSS 防御暴露或需要打断时抓住时机。
- **灵兽行为规则**：灵兽技能采用固定回合间隔自动触发，玩家无法主动点按。应为每只灵兽配置基础间隔、星级缩减规则及被动触发条件（如被主角技能强制行动时的处理），并允许特定神通临时刷新间隔或立即触发一次行动。
- **控制影响**：硬控（眩晕、冰冻、沉默等）会跳过被控单位当回合行动，相当于间接打断技能。系统需在控制判定时清晰记录是否消耗回合、是否影响技能资源，并在战斗日志中提示“本回合行动被跳过”。

### 9.1 回合与操作节奏
- **自动与手动协同**：常规输出（普攻、部分被动）默认托管执行，主角道法提供手动释放按钮。支持在战斗中途切换模式：自动模式优先根据配置表循环技能，若玩家在某回合手动干预，则该回合以玩家操作为准，下一回合自动逻辑重新接管。
- **关键技能提示**：当道法、神识等核心技能满足施放条件时，UI 需弹出高亮提示，自动模式下可设置“自动施放”或“保留至手动”两个策略，以便玩家提前设定战术。
- **灵兽技能节奏**：举例：鸾鸟默认 `interval = 2`（首回合待命、第二回合释放、之后隔回合触发）；白虎每隔 2 回合发动一次群攻；青龙 `interval = 1`，每回合均释放技能。强制行动（如“帝御九霄”）会立即执行技能，同时在数据上重置或延后下一次触发时间，避免频率异常。

### 9.2 行动顺序判定
- **敏捷决定先后手**：每个单位在每回合开局时根据敏捷（Speed）进行排序，敏捷高者先行动。若敏捷相同，可采用战斗 ID 或上一回合顺序作为平局处理，保证判定可预测。
- **动态敏捷调整**：战斗过程中若敏捷发生变化（装备加成、技能 Buff、减速 Debuff），从下一回合开始重新排序。系统需记录当前回合是否已完成行动，避免即时调整导致重复行动。
- **控制对顺序的影响**：被眩晕、冰冻、沉睡等状态的单位直接跳过该回合行动，相当于从排序队列中移除一次机会。状态解除后按最新敏捷值重新参与排序。
- **先机类效果**：某些技能或血脉带有“先机”标签，为前 X 回合提供额外伤害或敏捷加成。该类效果在排序阶段生效，可视为在计算敏捷前附加百分比加成。

### 9.3 技能释放判定
- **瞬发结算**：所有技能均在单位行动阶段瞬时生效，无蓄力条。若因控制错失行动，技能资源保持原状（妖气不消耗、冷却不推进），等待下一次行动机会。
- **技能冲突处理**：当多个被动在同一触发点生效时按照优先级执行，例如护盾类优于反击类，再到恢复类，以确保数值结算一致。
- **资源校验**：技能释放前检测妖气是否达标、目标状态是否满足（如眩晕目标额外伤害、命中后延长眩晕等），并根据结果输出不同分支效果。

## 10. 技能发动机制细化
- **冷却 / 间隔定义**：
  - 主角神通遵循“资源即冷却”理念，只要满足条件即可即时施放，无额外秒数冷却。
  - 灵兽技能使用“回合间隔”字段配置（如 `interval = 2` 代表隔 1 回合释放一次）。当外部效果强制灵兽行动时，需刷新其间隔或标记下一次施放延后。
- **资源消耗体系**：
  - 妖气是真气类通用资源，默认每回合提供基础回复，受到普通攻击、灵兽行动、特定被动等影响。
  - 技能可定义`妖气消耗`与`妖气增益`参数，用于建模诸如“啸月”“万妖体”等回气技能，以及“蚀魂咒”类削减敌方妖气的控制。
- **状态依赖效果**：技能需支持根据目标状态调整效果（如目标处于眩晕时伤害增强、延长控制），在数据结构中预留`conditional_effects`字段描述状态条件与加成。

### 10.1 资源获取与管理
- **妖气增长节奏**：默认每回合开局恢复基础妖气值（可按角色等级或装备系数设定），普通攻击命中、受到攻击、灵兽技能触发均可额外补充妖气。可在战斗配置中设置 `base_yq_gain`、`on_hit_gain`、`pet_skill_gain` 等参数。
- **回气神通**：如“啸月”设定为“灵兽释放技能后，给主人回复 1400 妖气”，需在事件监听器中捕捉灵兽技能完成事件，并对主角资源做加算；“万妖体”则在每回合开始事件中执行固定增量。
- **资源压制**：控制类技能（例如“蚀魂咒”）在命中敌人时扣减其妖气，同时可设置 `yq_block_turns` 附加效果，表示若敌人妖气被削减至阈值以下，将延迟其下次道法施放。需保证扣减不为负，且与妖气上限、回复挂钩。
- **资源溢出处理**：当妖气达到上限后继续获得收益时，支持将溢出部分转化为“能量护盾”或“怒气层数”，以免玩家因提前积攒而浪费资源。该机制可在数值表中按技能或血脉配置。

#### 真气基础参数（对齐《寻道大千》）
- **资源上限与起手值**：战斗双方默认拥有 100 点真气上限，并以 0 点真气开局；后续所有结算均会在 0~上限区间内自动截断，避免溢出或负值。
- **全局参数管理**：管理员可在后台「系统设置 → 真气增长参数」中调整开局值、每回合回复、普攻增益、受击系数与暴击回气；系统设置不可用时回退到默认配置（0 / 20 / 10 / 1.5 / 1 / 1）。
- **基础增益与倍率**：所有基础真气获取都会乘以 `rageGain`（真气回复系数），若最终值被削减至 0 以下，则按 0 处理，不会产生负回复。
- **默认增益速查表**（定义于 `skill-engine/index.js` 的 `RESOURCE_CONFIG` 中，数值单位均为点）：

  | 触发场景 | 基础增益 |
  | --- | --- |
  | 回合开始 | 20 |
  | 普攻命中 | 10 |
  | 承受任意直接伤害（含 DOT、连击、反震等） | 掉血比例 × 150% × 真气上限 |
  | 造成暴击 | 1 |
  | 遭受暴击 | 1 |

- **受击回气公式**：目标在一次结算中损失 `n%` 生命时，按 `n% × 1.5 × 真气上限`（系数默认 1.5，可在后台调整）计算基础增益，再乘以 `rageGain` 系数取整后记入战斗事件。

- **技能消耗判定**：主动技能读取 `params.cost` 作为真气消耗值，资源不足时会自动改为普攻，不触发技能冷却或额外扣值；技能消耗成功时会在战斗事件中写入 `resource` 变更，用于回放与审计。
- **资源事件追踪**：所有真气的恢复、消耗与压制均以结构化 `resource` 事件记录（含 `before`、`change`、`after`、`max`、`resourceType`），与生命值、护盾等状态同步出现在战斗时间线中。
- **参数覆写入口**：角色可通过 `combatant.resource`（或 `special.qiTurnGain`、`special.damageTakenGain` 等字段）自定义起手值、回合回复、普攻回气与受击回气；未配置时使用上述默认值。

### 10.2 施放策略支持
- **技能队列优先级**：自动战斗模式下，按照角色配置的优先级列表尝试施放技能；当妖气不足或条件不满足时自动跳过，避免无效判定。玩家可在战前对优先级进行排序，以适应不同流派需求。
- **条件延迟**：支持设置“保留施放”逻辑，例如当敌方存在护盾或高防 Buff 时，某些技能可等待条件消失再自动释放。数据中可通过 `hold_condition` 标记触发。
- **连携触发**：主角技能可定义“触发灵兽技能立即行动”或“额外刷新灵兽技能”的效果，系统需在执行后更新灵兽 `interval` 与冷却状态，确保下一次触发时间准确。

## 11. 技能资源管理与战术指引
- **蓄能规划**：鼓励玩家围绕妖气节奏设定战术。设计示例：第一回合使用增益或控制技能，第二回合在增益持续期间释放核心道法，实现爆发收益；或通过“护体金光”先稳住血线，再等待敌方露出破绽后爆发。
- **流派差异**：
  - *控制流*：优先使用削弱敌方妖气与控制技能（如“蚀魂咒”）阻止对手开大，配合高敏捷抢先手与灵兽延长控制链。
  - *爆发流*：集中配置回气技能（啸月、万妖体）快速攒满妖气，在关键回合一击致胜，但需关注 15 回合限制避免拖延。
  - *防守流*：通过体修技能堆叠护盾、减伤，等待敌人资源耗尽后反攻，强调资源的“守势管理”。
- **回合预算**：策划在关卡脚本中应标注推荐击杀回合数、关键爆发回合节点，便于数值测试确认不同流派均能在限制内获胜。

## 12. 技能获取与成长渠道
- **神通衍化抽取**：主要获取渠道，消耗天衍符/神通券随机生成技能，按灵感→开辟→通玄→悟道分品质。支持累计抽取保底机制（如 720 次保底悟道自选），重复技能转换为碎片用于升级。
- **日常任务与活动**：主线、成就、七日登录、限时活动等提供天衍符、技能碎片奖励。活动“神通灌顶”与“神通轮回”根据消耗次数发放返利或自选箱，鼓励玩家集中资源兑换稀有技能。
- **商店与兑换**：坊市与活动商店上架神通券礼包、技能碎片包、限定技能箱等，需设置合理价格与限购次数，确保氪金与免费玩家都能逐步积累。
- **副本掉落与额外来源**：高难副本（六道秘境等）掉落技能碎片或养成素材，角色境界提升、剧情奖励提供基础技能体验。副本以“素材产出”为主，间接支撑技能成长。
- **培养循环**：技能升级需消耗碎片与资源，25/40/50 级解锁印记槽位。文档建议在 UI 中突出“技能等级→印记→战力”路径，并引导玩家利用碎片升阶获得专属符印。
- **获取策略建议**：引导玩家攒够抽取次数一次性完成保底，以确保获得核心技能；同时设置概率 UP 池提升目标技能命中率。系统应提供“抽取记录”“保底进度条”等反馈，降低随机挫败感。

## 13. 技能模型共享与部署指引

### 13.1 公共技能模块
- 新增 `cloudfunctions/nodejs-layer/node_modules/skill-model` 模块，集中维护技能库、品质配置以及 `aggregateSkillEffects`、`resolveSkillEffects` 等技能加成算法。
- PVE 云函数统一通过该模块生成属性摘要与技能加成，避免重复定义并方便与策划数值同步。
- PVP 云函数在构建战斗快照时复用同一套技能计算逻辑，使擂台战斗与 PVE 推图共享一致的属性与伤害模型。

### 13.2 部署步骤
1. **更新共享层**：重新打包并上传 `cloudfunctions/nodejs-layer`，确保 `skill-model` 随 Node.js Layer 生效。
2. **重发业务函数**：重新部署 `pve` 与 `pvp` 云函数，使其引用新的公共技能模块。
3. **回归验证**：执行“技能获取 → 装备 → 战斗”冒烟流程，确认技能属性展示、战斗结算与排行榜统计中的技能加成保持一致。


---

此重构方案旨在将技能系统打造成兼具深度与可拓展性的框架，为后续版本的技能新增、平衡调整和跨系统联动提供坚实基础。
