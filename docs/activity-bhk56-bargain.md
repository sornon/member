# 感恩节 · BHK56 限量品鉴会砍价页设计与实现说明

## 目标与定位
- **活动编号**：`479859146924a70404e4f40e1530f51d`。
- **主题风格**：黑金主色 + 感恩节暖调，突出奢华、限量与倒计时紧迫感。
- **核心玩法**：转盘砍价 + 会员（修仙境界）加成 + 分享助力追加抽奖，底价隐藏（实付触达 998 时提示“你太幸运了！已经拿到最终底价，抓紧下单吧！”）。

## 关键交互流程
1. **入口跳转**：活动列表点击该 ID 时直接跳转独立页面 `/pages/activities/bhk-bargain/index`，其余活动保持原详情页逻辑。
2. **落地信息**：Banner 展示标题、倒计时、余票、地点与价格方案。基础数据来自活动云函数（若数据库缺失则使用内置兜底）。
3. **价格与权益**：展示原价与当前价、隐藏底价提示、权益亮点；规则浮层提供砍价/售票约束，权益文案突出“原价 ¥3500，拼手气拿到惊爆价”。
4. **砍价转盘**：
   - 默认 3 次抽奖；依据当前修仙境界（realmOrder）加成：元婴及以上 +1，合体及以上 +2。
  - 转盘结果实时扣减票价并弹出结果 overlay，砍到隐藏底价（998）时提示“你太幸运了！已经拿到最终底价，抓紧下单吧！”。
  - 未触达底价时，结果弹层会给出随机鼓励词（如“好友助力价格还能更低”），引导继续分享助力。
5. **分享助力**：
   - 分享按钮调起微信分享；“记录好友助力”模拟好友帮砍：每次随机减免并追加 1 次抽奖，最多 6 次。
   - 助力记录展示头像、昵称与减免金额，形成社交证明。
6. **购票引导**：底部固定栏展示实时票价与库存；若仍有砍价次数则购票前提示确认，避免误操作。

## 数据与后端
- `cloudfunctions/activities/index.js` 内置 **BHK56 兜底活动** 与 `bargainConfig`：
- 价格区间：¥3500 → （隐藏底价 998，UI 不展示）；默认抽奖 3 次；助力封顶 6 次；倒计时至 2025-12-01 24:00（北京时间）。
  - 配置字段包括转盘区间、助力减免范围、会员加成阈值、余票 15 张、封面/背景图、礼遇文案等。
  - 兜底数据同时注入活动列表与详情接口，确保数据库缺失时仍可访问。

## 前端实现要点
- 新增页面：`pages/activities/bhk-bargain/index`，采用 `custom-nav` 自定义头部，深色系 + 金色点缀的模块化布局（Banner、价格卡、转盘、分享、规则、底部购买）。
- 状态管理：
  - 砍价状态包含 `currentPrice`、`totalDiscount`、`remainingSpins`、`remainingDiscount`、`helperRecords` 等。
- 倒计时按秒刷新，落地时计算剩余时间；库存与底价/砍价状态实时联动。
- 会员加成：调用 `MemberService.getLevelProgress()` 获取 `currentLevel.realmOrder`，匹配等级设计文档（参考 `docs/level-plan.md`）的境界顺序确定加赠抽奖次数，并在 UI 提示当前境界加成。
- 分享与助力：
  - `onShareAppMessage`/`onShareTimeline` 定向至专属页面路径，附带封面图。
  - “记录好友助力”模拟助力砍价并追加次数，便于展示社交证明与玩法闭环。
- 规则浮层：汇总隐藏底价策略、境界加成、助力上限、库存限制等关键信息，减轻用户疑惑。

## 设计对照需求
- 头部 Banner、倒计时与余票提示、雪茄价值展示、砍价/助力/购买流程、规则说明等均按需求文案落地。
- 修仙等级（境界）被用于砍价次数加成，与现有等级体系接口复用，便于后续根据 `level-plan` 微调阈值或奖励。
