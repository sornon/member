# 菜单商品管理功能部署说明

## 功能概览

本次迭代将原先保存在 `miniprogram/shared/menu-data.js` 的静态菜单迁移到云数据库中统一管理，新增的云函数 `menuCatalog` 负责提供菜单读取以及管理员的增补能力，同时在管理员端新增「商品管理」页面，支持：

- 维护一级类目（如酒水、用餐等）
- 维护二级类目（如精品咖啡、红葡萄酒等）
- 新增商品及其规格、价格、描述、起订量
- 实时刷新菜单数据，前端会员点餐页自动读取数据库配置

## 数据结构

新增了三个集合用于存储菜单数据，集合名称在 `common-config` 中暴露：

| 集合名            | 说明                     | 关键字段 |
| ----------------- | ------------------------ | -------- |
| `menuSections`    | 一级类目定义             | `sectionId`, `name`, `sortOrder`, `status` |
| `menuCategories`  | 二级类目定义（隶属一级） | `sectionId`, `categoryId`, `name`, `sortOrder`, `status` |
| `menuItems`       | 商品条目                 | `sectionId`, `categoryId`, `itemId`, `title`, `variants`, `minQuantity`, `sortOrder`, `status` |

`variants` 字段为数组，结构与原先菜单一致：`[{ label, unit, price }]`，价格仍以分为单位存储。

## 部署步骤

1. **上传云函数**：
   - 在微信开发者工具中选择云函数目录 `cloudfunctions/menuCatalog`，上传并部署到对应环境。
   - 确认云函数拥有读写上述三个集合的权限。

2. **创建集合**：
   - 在云开发控制台中手动创建 `menuSections`、`menuCategories`、`menuItems` 集合（若第一次运行云函数也会自动创建，但推荐提前创建以设置索引）。
   - 可按需为 `sectionId`、`categoryId`、`itemId` 建立唯一索引，防止重复数据。

3. **初始化数据**（可选）：
   - 若需导入历史菜单，可参照原 `menu-data.js` 的内容，通过管理员页面逐条录入，或自建脚本写入集合。
   - 录入时价格以“元”为单位填写，云函数会自动转换为“分”保存。

4. **更新小程序端**：
   - 重新编译小程序，确保 `pages/admin/menu-catalog` 页面以及会员端点餐页的菜单均从云端获取。

## 使用指南

- 管理员进入「管理员中心 → 商品管理」即可查看和维护菜单。
- 一级类目、二级类目均支持设置排序值，数值越小越靠前；可根据需要使用英文标识以便后续引用。
- 新增商品时：
  - `标识` 字段需保持唯一。
  - `价格` 以“元”为单位填写（支持小数）。
  - `规格`、`单位` 用于在点餐页展示，如“杯 /杯”。
  - `起订` 为可选项，不填视为 1；若填写将自动取整。
  - 可录入可选的描述与图片地址，前端将直接展示。
- 商品、类目创建后无需手动刷新会员端页面，数据会在下次打开点餐页时自动生效。

## 注意事项

- 若需新增更多层级或批量导入，可在 `menuCatalog` 云函数基础上扩展对应 action。
- 管理员页面当前仅提供新增能力，后续如需编辑/下架可进一步在云函数中补充更新与删除逻辑。
- 为保持数据一致性，请避免继续修改 `shared/menu-data.js`，该文件仅作为空白占位与降级备用。
