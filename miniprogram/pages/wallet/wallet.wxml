<custom-nav title="现金钱包" theme="dark"></custom-nav>
<view class="container">
  <view class="card">
    <view class="section-title">现金余额</view>
    <view wx:if="{{loading}}">加载中...</view>
    <view wx:elif="{{summary}}">
      <view class="balance">{{summary.cashBalanceText}}</view>
      <view class="meta">累计充值：{{summary.totalRechargeText}} · 累计消费：{{summary.totalSpendText}}</view>
      <button class="scan" size="mini" bindtap="handleScanCharge">扫码扣费</button>
    </view>
  </view>

  <view class="card">
    <view class="section-title">存酒概览</view>
    <view wx:if="{{loading}}">加载中...</view>
    <view wx:elif="{{summary}}">
      <view class="wine-total">当前存酒 {{summary.totalWineQuantity}} 瓶</view>
      <view wx:if="{{summary.wineStorage.length}}" class="wine-list">
        <view class="wine-item" wx:for="{{summary.wineStorage}}" wx:key="id">
          <view class="wine-name">{{item.name}}</view>
          <view class="wine-meta">数量：{{item.quantity}} 瓶 · 到期：{{item.expiresAtText}}</view>
        </view>
      </view>
      <view wx:else class="wine-empty">暂无存酒记录</view>
    </view>
  </view>

  <view class="card">
    <view class="section-title">快捷充值</view>
    <view wx:if="{{summary && summary.features && !summary.features.cashierEnabled}}" class="recharge-disabled">
      目前只支持收款台线下充值
    </view>
    <block wx:else>
      <view class="presets">
        <view
          class="preset {{amount === item ? 'active' : ''}}"
          wx:for="{{presets}}"
          wx:key="value"
          data-value="{{item}}"
          bindtap="handlePresetTap"
        >
          ¥{{item}}
        </view>
      </view>
      <view class="input-box">
        <input type="number" placeholder="输入自定义金额" value="{{amount}}" bindinput="handleAmountInput"/>
      </view>
      <button type="primary" bindtap="handleRecharge">立即充值</button>
    </block>
  </view>

  <view class="card">
    <view class="section-title">余额流水</view>
    <view wx:if="{{loading}}">加载中...</view>
    <view wx:elif="{{!summary || !summary.transactions.length}}" class="empty-state">暂无流水记录</view>
    <view wx:else>
      <view class="transaction" wx:for="{{summary.transactions}}" wx:key="_id">
        <view>
          <view class="txn-title">{{item.typeLabel}}</view>
          <view class="txn-date">{{item.displayDate}}</view>
          <view class="txn-remark" wx:if="{{item.remark}}">{{item.remark}}</view>
        </view>
        <view class="txn-amount {{item.amountClass}}">{{item.amountText}}</view>
      </view>
    </view>
  </view>
</view>
