<view class="boss-page">
  <view wx:if="{{loading}}" class="state">Boss 情报加载中...</view>
  <view wx:elif="{{error}}" class="state state--error">{{error}}</view>
  <scroll-view wx:else scroll-y class="boss-scroll" enable-flex="true">
    <view wx:if="{{boss}}" class="boss-card">
      <view class="boss-card__header">
        <view class="boss-card__title">{{boss.name || '未知 Boss'}}</view>
        <view class="boss-card__meta">等级 {{boss.level || 1}} · 状态 {{boss.status || '未知'}}</view>
      </view>
      <view class="boss-card__progress">
        <view class="boss-card__progress-bar">
          <view class="boss-card__progress-inner" style="width: {{boss.hp.percent}}%;"></view>
        </view>
        <view class="boss-card__progress-text">{{boss.hp.current}} / {{boss.hp.max}}</view>
      </view>
      <view class="boss-card__stats">
        <text>总伤害 {{formatNumber(boss.totalDamage || 0)}}</text>
        <text>剩余尝试 {{boss.attempts ? boss.attempts.remaining : 0}} / {{boss.attempts ? boss.attempts.limit : 0}}</text>
        <text>冷却 {{boss.attempts ? boss.attempts.cooldownText : '未知'}}</text>
      </view>
      <view class="boss-card__actions">
        <button
          class="btn btn--primary"
          bindtap="handleChallenge"
          loading="{{challenging}}"
          disabled="{{!canChallenge || challenging}}"
        >发起挑战</button>
        <button class="btn btn--ghost" bindtap="handleRefreshTicket">刷新令牌</button>
      </view>
    </view>

    <view class="rank-card">
      <view class="rank-card__header">
        <view class="rank-card__title">伤害排行榜</view>
        <view wx:if="{{rankLoading}}" class="rank-card__loading">刷新中...</view>
      </view>
      <view wx:if="{{rankEntries.length === 0}}" class="empty">暂无伤害数据</view>
      <block wx:else wx:for="{{rankEntries}}" wx:key="memberId">
        <view class="rank-item">
          <view class="rank-item__rank">{{item.rank}}</view>
          <view class="rank-item__body">
            <view class="rank-item__name">{{item.memberName || item.name || '匿名侠士'}}</view>
            <view class="rank-item__damage">伤害 {{item.damageText}}</view>
          </view>
        </view>
      </block>
    </view>
  </scroll-view>
</view>
