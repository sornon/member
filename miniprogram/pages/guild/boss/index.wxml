<custom-nav title="Boss 讨伐" theme="dark"></custom-nav>
<view class="guild-page guild-page--boss">
  <scroll-view scroll-y class="guild-scroll" enable-flex="true">
    <block wx:if="{{loading}}">
      <view class="state state--loading">Boss 情报加载中...</view>
    </block>
    <block wx:elif="{{error}}">
      <view class="state state--error">{{error}}</view>
    </block>
    <view wx:else class="guild-content">
      <view wx:if="{{boss}}" class="guild-section boss-card">
        <view class="boss-card__header">
          <view class="boss-card__title">{{boss.name || '未知 Boss'}}</view>
          <view class="boss-card__meta">等级 {{boss.level || 1}} · 状态 {{boss.status || '未知'}}</view>
        </view>
        <view class="boss-card__progress">
          <view class="boss-card__progress-bar">
            <view class="boss-card__progress-inner" style="width: {{boss.hp.percent}}%;"></view>
          </view>
          <view class="boss-card__progress-text">{{boss.hp.current}} / {{boss.hp.max}}</view>
        </view>
        <view class="boss-card__stats">
          <text>总伤害 {{formatNumber(boss.totalDamage || 0)}}</text>
          <text>剩余尝试 {{boss.attempts ? boss.attempts.remaining : 0}} / {{boss.attempts ? boss.attempts.limit : 0}}</text>
          <text>冷却 {{boss.attempts ? boss.attempts.cooldownText : '未知'}}</text>
        </view>
        <view class="boss-card__actions">
          <button
            class="btn btn--primary"
            bindtap="handleChallenge"
            loading="{{challenging}}"
            disabled="{{!canChallenge || challenging}}"
          >发起挑战</button>
          <button class="btn btn--ghost" bindtap="handleRefreshTicket">刷新令牌</button>
        </view>
      </view>

      <view class="guild-section guild-section--compact rank-card">
        <view class="rank-card__header">
          <view class="rank-card__title">伤害排行榜</view>
          <view wx:if="{{rankLoading}}" class="rank-card__loading">刷新中...</view>
        </view>
        <block wx:if="{{rankEntries.length === 0}}">
          <view class="empty">暂无伤害数据</view>
        </block>
        <block wx:else>
          <block wx:for="{{rankEntries}}" wx:key="memberId">
            <view class="rank-item">
              <view class="rank-item__rank">{{item.rank}}</view>
              <view class="rank-item__body">
                <view class="rank-item__name">{{item.memberName || item.name || '匿名侠士'}}</view>
                <view class="rank-item__damage">伤害 {{item.damageText}}</view>
              </view>
            </view>
          </block>
        </block>
      </view>
    </view>
  </scroll-view>
</view>
