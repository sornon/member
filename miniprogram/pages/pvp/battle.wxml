<custom-nav title="战报回放" theme="dark"></custom-nav>
<view class="container battle-page">
  <view wx:if="{{loading}}" class="card battle-state">战报加载中...</view>
  <block wx:elif="{{battle}}">
    <view class="card battle-header">
      <view class="battle-result">{{battle.header.title}}</view>
      <view class="battle-meta">{{(battle.participants.player && battle.participants.player.displayName) || '我方'}} VS {{(battle.participants.opponent && battle.participants.opponent.displayName) || '对手'}}</view>
      <view wx:if="{{battle.header.subtitle}}" class="battle-meta">{{battle.header.subtitle}}</view>
      <view class="battle-meta">{{battle.createdAtText}}</view>
    </view>
    <view class="card battle-summary">
      <view class="battle-summary__item">
        <text class="battle-summary__label">我方积分</text>
        <text class="battle-summary__value">{{battle.player.pointsAfter}}（{{battle.player.pointsDelta >= 0 ? '+' : ''}}{{battle.player.pointsDelta}}）</text>
      </view>
      <view class="battle-summary__item">
        <text class="battle-summary__label">对手积分</text>
        <text class="battle-summary__value">{{battle.opponent.pointsAfter}}（{{battle.opponent.pointsDelta >= 0 ? '+' : ''}}{{battle.opponent.pointsDelta}}）</text>
      </view>
    </view>
    <view class="card battle-rounds">
      <block wx:for="{{rounds}}" wx:key="index">
        <view class="round-item">
          <view class="round-title">第 {{item.round}} 回合</view>
          <view class="round-description">{{item.description}}</view>
          <view
            wx:if="{{item.hpSummary && (item.hpSummary.player !== null || item.hpSummary.opponent !== null)}}"
            class="round-meta"
          >
            我方血量：{{item.hpSummary.player !== null ? item.hpSummary.player : '-'}} · 对手血量：{{
              item.hpSummary.opponent !== null ? item.hpSummary.opponent : '-'
            }}
          </view>
          <view wx:elif="{{item.targetRemainingHp != null}}" class="round-meta">对手剩余血量：{{item.targetRemainingHp}}</view>
        </view>
      </block>
    </view>
  </block>
  <view wx:else class="card battle-state">未找到战报</view>
</view>
