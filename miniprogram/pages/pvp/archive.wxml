<view class="archive-page">
  <view class="background background--fallback">
    <image class="background-fallback__image" src="{{backgroundImage}}" mode="aspectFill"></image>
  </view>
  <view
    wx:if="{{backgroundVideo && showBackgroundVideo}}"
    class="background background--video background-layer background-layer--visible"
  >
    <video
      class="background-video background-layer background-layer--visible"
      src="{{backgroundVideo}}"
      autoplay
      loop
      muted
      controls="{{false}}"
      show-center-play-btn="{{false}}"
      show-fullscreen-btn="{{false}}"
      show-play-btn="{{false}}"
      enable-progress-gesture="{{false}}"
      objectFit="cover"
      binderror="handleBackgroundVideoError"
    ></video>
  </view>
  <view class="background background--overlay background-layer"></view>
  <view class="mist-layer mist-layer--one background-layer"></view>
  <view class="mist-layer mist-layer--two background-layer"></view>

  <custom-nav title="角色档案" theme="transparent" enable-back="{{true}}"></custom-nav>

  <view class="archive-content" style="min-height: calc(100vh - {{navHeight}}px);">
    <view wx:if="{{loading}}" class="archive-state">灵气汇聚中...</view>
    <view wx:elif="{{error}}" class="archive-state archive-state--error">{{error}}</view>

      <view class="archive-hero">
        <view class="archive-profile-card">
          <view class="profile-avatar-wrapper">
            <image class="profile-avatar" src="{{archive.avatarUrl || defaultAvatar}}" mode="cover"></image>
            <image
              wx:if="{{archive.avatarFrame}}"
              class="profile-avatar-frame"
              src="{{archive.avatarFrame}}"
              mode="scaleToFill"
            ></image>
          </view>
          <view class="profile-info">
            <view class="profile-identity">
              <view class="profile-name">{{archive.nickName || '神秘仙友'}}</view>
              <view wx:if="{{titleImage}}" class="profile-meta__title">
                <image class="profile-meta__title-image" src="{{titleImage}}" mode="heightFix"></image>
              </view>
            </view>
            <view class="profile-record">
                <text class="profile-meta__text">境界 {{archive.levelName || '未知境界'}}</text>
                <text class="profile-meta__text">战力 {{combatPowerText}}</text>
                <text class="profile-meta__text">{{archive.tier.name}} {{archive.points}} 分</text>
                <text class="profile-meta__text">战绩 {{archive.wins}}胜{{archive.losses}}负{{archive.draws}}平</text>
            </view>
          </view>
        </view>
        <view class="archive-figure">
          <view class="archive-figure__image-wrapper figure-scale {{heroFigureScaleClass}}">
            <image class="archive-figure__image" src="{{heroImage}}" mode="widthFix"></image>
          </view>
        </view>
      </view>

      <view class="archive-panel">
        <view class="panel-card" wx:if="{{attributeList.length || combatStats.length || equippedSkills.length}}">
          <view class="panel-header">属性面板</view>
          <view class="attribute-grid" wx:if="{{attributeList.length}}">
            <block wx:for="{{attributeList}}" wx:key="key">
              <view class="attribute-cell">
                <view class="attribute-label">{{item.label}}</view>
                <view class="attribute-value">{{item.formattedValue}}</view>
              </view>
            </block>
          </view>
          <view class="combat-grid">
            <block wx:for="{{combatStats}}" wx:key="key">
              <view class="combat-cell">
                <view class="combat-label">{{item.label}}</view>
                <view class="combat-value">{{item.formattedValue}}</view>
              </view>
            </block>
          </view>
          <view class="skills-section">
            <view class="skills-header">佩戴技能</view>
            <view wx:if="{{equippedSkills.length}}" class="skill-chip-list">
              <view class="skill-chip" wx:for="{{equippedSkills}}" wx:key="skillId">
                <text class="skill-chip__name" style="color: {{item.qualityColor}};">{{item.name}}</text>
                <text class="skill-chip__level">Lv.{{item.level}}</text>
              </view>
            </view>
            <view wx:else class="skill-empty">暂未佩戴技能</view>
          </view>
        </view>
      </view>

  </view>
</view>
