<custom-nav title="感恩节活动管理" theme="dark"></custom-nav>
<view class="page">
  <view class="hero">
    <view class="hero-text">
      <view class="hero-title">BHK 感恩节活动监控</view>
      <view class="hero-subtitle">实时查看下单数、库存与权益发放状态</view>
      <view wx:if="{{summary.updatedAtLabel}}" class="hero-updated">更新于 {{summary.updatedAtLabel}}</view>
    </view>
    <button class="refresh-btn" bindtap="handleRefresh" loading="{{loading}}">{{loading ? '刷新中…' : '刷新数据'}}</button>
  </view>

  <view class="summary-grid">
    <view class="summary-card">
      <view class="summary-label">实时下单数</view>
      <view class="summary-value">{{summary.orderCount || 0}}</view>
      <view class="summary-desc">展示最近 {{summary.orderLimit || 0}} 笔下单明细</view>
    </view>
    <view class="summary-card">
      <view class="summary-label">库存</view>
      <view class="summary-value">{{summary.stockRemaining}} / {{summary.totalStock}}</view>
      <view class="summary-desc">已售 {{summary.sold}}</view>
    </view>
    <view class="summary-card">
      <view class="summary-label">权益使用</view>
      <view class="summary-value">{{summary.rightsTotal}}</view>
      <view class="summary-desc">{{summary.rightsSummary || '未发放'}}</view>
    </view>
  </view>

  <view class="section">
    <view class="section-title">权益使用状态</view>
    <view wx:if="{{summary.rightsBreakdown.length}}" class="pill-row">
      <view wx:for="{{summary.rightsBreakdown}}" wx:key="status" class="pill">
        <text class="pill-count">{{item.count}}</text>
        <text class="pill-label">{{item.label}}</text>
      </view>
    </view>
    <view wx:else class="empty-text">暂未发放感恩节通行证权益</view>
  </view>

  <view class="section">
    <view class="section-title">实时下单明细</view>
    <view wx:if="{{orders.length}}" class="order-list">
      <view wx:for="{{orders}}" wx:key="{{item.orderId || item.memberId || index}}" class="order-card">
        <view class="order-header">
          <view class="order-member">{{item.displayName}}</view>
          <view class="order-amount">{{item.amountLabel || '¥0.00'}}</view>
        </view>
        <view class="order-meta">会员 ID：{{item.memberId}}</view>
        <view wx:if="{{item.mobile}}" class="order-meta">手机号：{{item.mobile}}</view>
        <view class="order-meta">下单时间：{{item.purchasedAtLabel || '—'}}</view>
        <view class="order-meta">订单号：{{item.orderId || '待补全'}}</view>
        <view class="order-tags">
          <view class="tag solid">权益：{{item.rightStatusLabel}}</view>
          <view class="tag" wx:if="{{item.ticketOwned}}">已落地购票</view>
        </view>
      </view>
    </view>
    <view wx:else class="empty-text">暂无购票记录，等待新的实时订单。</view>
  </view>

  <view wx:if="{{error}}" class="error-banner">{{error}}</view>
</view>
