# pvp-config.json 字段说明

此文件定义 PVP 排位/匹配相关的全局参数。配置文件只保留一套字段，所有版本切换通过数据库集合中的多条记录与 `status` 控制完成。

- `roundLimit`：PVP 战斗的最大回合数。超出则视为平局，用于限制拖到疲劳局。【F:cloudfunctions/nodejs-layer/node_modules/balance/simulator.js†L61-L76】
- `cooldownMs`：同一玩家发起 PVP 战斗的冷却时间（毫秒）。
- `cooldownMessage`：处于冷却状态时返回给玩家的提示文案。
- `seasonLengthDays`：赛季时长（天），用于服务器重置排行/发放奖励的周期。
- `leaderboardCacheSize`：排行榜缓存数量上限，用于限制内存占用及接口返回条数。
- `leaderboardSchemaVersion`：排行榜数据结构版本号，便于迁移或兼容处理。
- `recentMatchLimit`：保留最近对局记录的数量，用于匹配冷却或展示。
- `defaultRating`：新玩家的 Elo/天梯初始分数。
- `tiers`：段位区间列表，按从低到高定义。每个段位包含 `id`、`name`、`min`/`max`、`color`、`rewardKey`。
- `tierRewards`：各段位赛季奖励定义，以 `rewardKey` 为键，值包含 `stones`（货币数量）、`title`（称号字符串）、`coupon`（可为空的券 ID）。

> 运行时通过 `getPvpConfig()` 读取，缺失字段都会从默认配置回填，保证匹配、排行榜和奖励逻辑的参数完整性。【F:cloudfunctions/nodejs-layer/node_modules/balance/config-loader.js†L253-L339】【F:cloudfunctions/nodejs-layer/node_modules/balance/simulator.js†L61-L76】

## 顶层参数表

| 属性名 | 中文含义 | 默认值 | 备注 |
| --- | --- | --- | --- |
| `roundLimit` | PVP 最大回合数 | `15` | 超出则视为平局，限制双方拖到疲劳局 |
| `cooldownMs` | 战斗冷却时间（毫秒） | `10000` | 控制匹配频率，避免刷战斗和高频刷新 Elo |
| `cooldownMessage` | 冷却提示文案 | `"您的上一场战斗还没结束，请稍后再战"` | 冷却期间提示玩家剩余等待 |
| `seasonLengthDays` | 赛季时长（天） | `56` | 赛季重置周期，决定发奖节奏 |
| `leaderboardCacheSize` | 排行榜缓存条数上限 | `100` | 限制排行榜返回量与缓存，避免接口过大 |
| `leaderboardSchemaVersion` | 排行榜数据版本 | `2` | 便于数据迁移/兼容，不同版本结构用此区分 |
| `recentMatchLimit` | 最近对局记录保留数量 | `10` | 用于匹配冷却或历史展示，防止列表过长 |
| `defaultRating` | 新玩家初始分 | `1200` | Elo/天梯起始分 |

### tiers（段位区间定义）

| 段位 id | 名称 | 分数下限 | 分数上限 | 颜色 | 奖励 key | 备注 |
| --- | --- | --- | --- | --- | --- | --- |
| `bronze` | 青铜 | `0` | `999` | `#c4723a` | `bronze` | 入门段位 |
| `silver` | 白银 | `1000` | `1499` | `#c0c0c0` | `silver` | 进阶段位 |
| `gold` | 黄金 | `1500` | `1999` | `#d4af37` | `gold` | 中高端段位 |
| `platinum` | 白金 | `2000` | `2399` | `#e5f0ff` | `platinum` | 高段位 |
| `diamond` | 钻石 | `2400` | `2799` | `#7dd3fc` | `diamond` | 顶尖段位入口 |
| `master` | 宗师 | `2800` | `99999`（视为 Infinity） | `#f472b6` | `master` | 最高段位，无上限 |

### tierRewards（赛季奖励）

| 奖励 key | 货币 `stones` | 称号 `title` | 优惠券 `coupon` | 备注 |
| --- | --- | --- | --- | --- |
| `bronze` | `50` | `"青铜试剑者"` | `null` | 入门奖励，无券 |
| `silver` | `80` | `"白银破阵者"` | `"coupon_pvp_silver"` | 白银段位券奖励 |
| `gold` | `120` | `"黄金斗剑士"` | `"coupon_pvp_gold"` | 黄金段位券奖励 |
| `platinum` | `160` | `"白金灵刃"` | `"coupon_pvp_platinum"` | 白金段位券奖励 |
| `diamond` | `220` | `"钻石星耀者"` | `"coupon_pvp_diamond"` | 钻石段位券奖励 |
| `master` | `320` | `"宗师武曲星"` | `"coupon_pvp_master"` | 最高段位奖励 |
